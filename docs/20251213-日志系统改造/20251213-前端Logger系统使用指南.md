# 前端 Logger 系统使用指南

## 概述

为了解决前端代码中大量 `console.log` 调试输出导致的生产环境日志污染问题，我们引入了统一的 Logger 管理系统。

## 核心特性

### 🎯 零配置使用
- 自动检测开发/生产环境
- 开发环境默认显示所有日志
- 生产环境默认只显示错误日志

### 🔧 灵活配置
- 支持全局日志级别控制
- 支持模块级别的精细控制
- 支持运行时动态调整

### 🚀 性能优化
- 生产环境零开销（日志调用会被跳过）
- 智能级别检查，避免不必要的计算

### 🎨 开发友好
- 彩色日志输出
- 时间戳显示
- 模块标识前缀

## 基础使用

### 1. 导入和创建 Logger

```typescript
import { createLogger } from '@/lib/logger';

// 创建模块专用 logger
const dashboardLog = createLogger('Dashboard');
```

### 2. 使用不同级别的日志

```typescript
// Debug 级别 - 仅开发环境显示
dashboardLog.debug('用户进入页面', { userId: 123 });

// Info 级别 - 一般信息
dashboardLog.info('数据加载完成', { count: 50 });

// Warning 级别 - 警告信息
dashboardLog.warn('API 响应较慢', { duration: 3000 });

// Error 级别 - 错误信息（生产环境也会显示）
dashboardLog.error('请求失败', { error: 'network_error' });
```

## 迁移指南

### 从 console.log 迁移

**原来的代码：**
```typescript
dashboardLog.debug('🏠 [Dashboard] 用户已登录，开始获取账本列表');
dashboardLog.debug('🏠 [Dashboard] 账本变化检测:', { isAuthenticated, currentAccountBook });
dashboardLog.error('🏠 [Dashboard] 获取记账详情失败:', error);
```

**迁移后的代码：**
```typescript
import { createLogger } from '@/lib/logger';

const dashboardLog = createLogger('Dashboard');

dashboardLog.debug('用户已登录，开始获取账本列表');
dashboardLog.debug('账本变化检测', { isAuthenticated, currentAccountBook });
dashboardLog.error('获取记账详情失败', error);
```

### 自动迁移工具

我们提供了自动迁移脚本来帮助批量替换：

```bash
# 预览模式（不修改文件）
node scripts/migrate-console-logs.js --dry-run

# 处理单个文件
node scripts/migrate-console-logs.js --file=apps/web/src/app/dashboard/page.tsx

# 处理所有文件
node scripts/migrate-console-logs.js
```

## 运行时配置

### 开发环境调试

在浏览器控制台中可以动态调整日志级别：

```javascript
// 设置全局日志级别
setLogLevel('INFO');  // 只显示 INFO 及以上级别
setLogLevel('NONE');  // 完全禁用日志

// 设置特定模块的日志级别
setModuleLogLevel('Dashboard', 'DEBUG');
setModuleLogLevel('API', 'ERROR');

// 查看当前配置
getLoggerDebugInfo();
```

### URL 参数控制

通过 URL 参数临时启用调试：

```
https://yourapp.com/dashboard?debug=true
https://yourapp.com/dashboard?logLevel=DEBUG
```

### 生产环境启用

如果需要在生产环境临时启用日志（用于问题排查）：

```javascript
// 在浏览器控制台中执行
loggerConfig.setEnabledInProduction(true);
loggerConfig.setGlobalLevel(LogLevel.INFO);
```

## 最佳实践

### 1. 日志级别选择

- **DEBUG**: 详细的调试信息，仅开发环境需要
- **INFO**: 一般的业务流程信息
- **WARN**: 警告信息，不影响功能但需要注意
- **ERROR**: 错误信息，影响功能正常运行

### 2. 消息格式

```typescript
// ✅ 好的做法
dashboardLog.debug('用户登录成功', { userId, loginTime });
dashboardLog.error('API 请求失败', { url, status, error });

// ❌ 避免的做法
dashboardLog.debug('🏠 [Dashboard] 用户登录成功!!!'); // 不需要表情符号和模块标识
```

### 3. 性能考虑

```typescript
// ✅ 好的做法 - logger 会自动检查级别
dashboardLog.debug('复杂计算结果', expensiveCalculation());

// ✅ 更好的做法 - 避免不必要的计算
if (process.env.NODE_ENV === 'development') {
  dashboardLog.debug('复杂计算结果', expensiveCalculation());
}
```

### 4. 敏感信息处理

```typescript
// ✅ 安全的做法
paymentLog.debug('支付请求', { 
  orderId, 
  amount, 
  // 不记录敏感信息如密码、token 等
});

// ❌ 危险的做法
paymentLog.debug('支付请求', { 
  orderId, 
  amount, 
  creditCard: '1234-5678-9012-3456' // 敏感信息
});
```

## 配置持久化

Logger 配置会自动保存到 localStorage，页面刷新后仍然有效：

```typescript
// 配置会自动保存
loggerConfig.setGlobalLevel(LogLevel.INFO);
loggerConfig.setModuleLevel('Dashboard', LogLevel.DEBUG);

// 导出配置（用于备份）
const settings = loggerConfig.exportSettings();

// 导入配置（用于恢复）
loggerConfig.importSettings(settings);

// 重置所有配置
loggerConfig.reset();
```

## 常见问题

### Q: 为什么生产环境看不到日志？
A: 这是设计如此。生产环境默认只显示 ERROR 级别的日志。如需临时启用，可以使用 `loggerConfig.setEnabledInProduction(true)`。

### Q: 如何在特定页面启用详细日志？
A: 可以通过 URL 参数 `?debug=true` 或在控制台中设置模块级别的日志。

### Q: 迁移后原有的调试信息会丢失吗？
A: 不会。所有原有的 `console.log` 会被转换为 `debug` 级别，在开发环境中仍然可见。

### Q: 如何处理第三方库的日志？
A: Logger 系统只管理我们自己的代码。第三方库的日志不受影响。

## 文件结构

```
apps/web/src/lib/
├── logger.ts              # 核心 Logger 类
├── logger-config.ts       # 配置管理
└── logger-examples.ts     # 使用示例

scripts/
└── migrate-console-logs.js # 自动迁移脚本
```

## 总结

通过引入统一的 Logger 系统，我们实现了：

1. **清洁的生产环境** - 不再有调试日志污染
2. **灵活的开发调试** - 可以精确控制日志输出
3. **零破坏性迁移** - 可以逐步替换现有代码
4. **性能优化** - 生产环境零开销

这个系统遵循了 "简单实用" 的设计原则，既解决了实际问题，又保持了开发体验的流畅性。