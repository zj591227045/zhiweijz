# 记账页面分类数据加载修复

## 问题描述

用户首次打开手动添加记账界面时显示"暂无分类数据"，关闭后再次打开就正常了。

## 根本原因

**数据流断裂**：项目正在从Zustand迁移到React Query，但迁移不完整导致状态管理混乱：

1. `TransactionAddPage`使用旧的`useAccountBookStore`
2. `useAccountBookStore.fetchAccountBooks()`是空函数，不获取任何数据
3. `currentAccountBook`始终为null，导致分类获取失败
4. React Query的`useAccountBooks`有数据，但没有同步到Zustand store

## 修复方案

### 1. 临时修复（保持向后兼容）

- 在`TransactionAddPage`中同时使用React Query和Zustand
- 将React Query数据同步到Zustand store
- 修复`fetchAccountBooks`空函数问题

### 2. 长期方案（建议）

完全迁移到React Query：
- 移除`useAccountBookStore`依赖
- 直接使用`useAccountBooks` hook
- 统一状态管理系统

## 修改文件

1. `apps/web/src/components/transactions/transaction-add-page.tsx`
   - 添加React Query数据获取
   - 同步数据到Zustand store
   - 修复加载状态显示

2. `apps/web/src/store/account-book-store.ts`
   - 修复`fetchAccountBooks`空函数
   - 添加临时API调用实现

## 测试验证

- [ ] 首次打开记账页面能正常显示分类
- [ ] 切换记账类型能正常加载对应分类
- [ ] 不影响现有功能
- [ ] 加载状态正确显示

## 技术债务

当前修复是临时方案，存在双重状态管理。建议后续：

1. 统一迁移到React Query
2. 移除Zustand兼容层
3. 简化数据流