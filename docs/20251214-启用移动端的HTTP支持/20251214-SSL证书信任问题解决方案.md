# SSL证书信任问题解决方案

## 问题描述
当前iOS和Android客户端在遇到以下情况时会直接拒绝连接：
1. HTTP协议连接
2. HTTPS协议但证书不受信任（自签名证书等）

用户无法选择是否继续连接，导致无法访问开发/测试环境的服务器。

## 解决方案

### Android端实现
1. 创建自定义的SSL信任管理器
2. 在网络请求失败时显示用户确认对话框
3. 用户确认后使用宽松的SSL配置重试请求

### iOS端实现
1. 实现NSURLSessionDelegate的证书验证方法
2. 在证书验证失败时显示用户确认对话框
3. 用户确认后允许不受信任的证书

### Web端配置
1. 更新Capacitor配置以支持混合内容
2. 确保网络安全配置允许HTTP连接

## 实现步骤

### 已完成的工作
1. ✅ **Android端实现**
   - 创建网络安全配置文件
   - 实现SSL信任管理器
   - 创建SSL配置插件
   - 更新MainActivity注册插件

2. ✅ **iOS端实现**
   - 创建SSL配置插件
   - 实现网络代理类处理SSL验证
   - 更新Info.plist支持任意传输安全
   - 配置Capacitor插件

3. ✅ **Web端实现**
   - 创建SSL配置服务
   - 更新API客户端集成SSL处理
   - 创建SSL配置管理组件
   - 集成到服务器设置页面

4. ✅ **配置文件更新**
   - 更新Android和iOS的Capacitor配置
   - 添加网络安全配置
   - 创建测试指南和文档

### 核心文件清单
- `apps/android/app/src/main/res/xml/network_security_config.xml`
- `apps/android/app/src/main/java/cn/jacksonz/pwa/twa/zhiweijz/utils/SSLTrustManager.java`
- `apps/android/app/src/main/java/cn/jacksonz/pwa/twa/zhiweijz/plugins/SSLConfigPlugin.java`
- `apps/ios/App/App/SSLConfigPlugin.swift`
- `apps/ios/App/App/NetworkDelegate.swift`
- `apps/web/src/lib/ssl-config.ts`
- `apps/web/src/components/ssl-config-manager.tsx`

## 安全考虑
- ✅ 明确警告用户安全风险
- ✅ 仅在用户明确同意后才允许不安全连接
- ✅ 保持对有效证书的正常验证流程
- ✅ 提供安全模式和宽松模式切换
- ✅ 详细的用户提示和说明信息

## 测试验证
参考 `20251214-SSL配置测试指南.md` 进行完整测试