# SSL配置测试指南

## 测试环境准备

### 1. 创建自签名证书的测试服务器
```bash
# 生成自签名证书
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes

# 使用Node.js创建HTTPS测试服务器
node -e "
const https = require('https');
const fs = require('fs');
const options = {
  key: fs.readFileSync('key.pem'),
  cert: fs.readFileSync('cert.pem')
};
https.createServer(options, (req, res) => {
  res.writeHead(200, {'Content-Type': 'application/json'});
  res.end(JSON.stringify({message: 'SSL测试服务器', timestamp: new Date()}));
}).listen(8443, () => console.log('HTTPS服务器运行在 https://localhost:8443'));
"
```

### 2. HTTP测试服务器
```bash
# 简单的HTTP服务器
python3 -m http.server 8080
# 或使用Node.js
node -e "
const http = require('http');
http.createServer((req, res) => {
  res.writeHead(200, {'Content-Type': 'application/json'});
  res.end(JSON.stringify({message: 'HTTP测试服务器', timestamp: new Date()}));
}).listen(8080, () => console.log('HTTP服务器运行在 http://localhost:8080'));
"
```

## 测试步骤

### Android端测试

1. **构建并安装应用**
   ```bash
   cd apps/android
   ./gradlew assembleDebug
   adb install app/build/outputs/apk/debug/app-debug.apk
   ```

2. **测试场景**
   - 连接到 `https://localhost:8443`（自签名证书）
   - 连接到 `http://localhost:8080`（HTTP协议）
   - 连接到过期证书的服务器

3. **预期行为**
   - 显示SSL安全警告对话框
   - 用户可以选择"继续连接"或"取消连接"
   - 选择继续后应该能正常访问

### iOS端测试

1. **构建并安装应用**
   ```bash
   cd apps/ios
   xcodebuild -workspace App.xcworkspace -scheme App -destination 'platform=iOS Simulator,name=iPhone 14' build
   ```

2. **测试场景**
   - 同Android端测试场景

3. **预期行为**
   - 同Android端预期行为

### Web端测试

1. **启动开发服务器**
   ```bash
   cd apps/web
   npm run dev
   ```

2. **测试场景**
   - 在浏览器中访问应用
   - 尝试连接到不同的服务器配置

3. **预期行为**
   - Web端应该显示"Web平台默认允许所有连接"
   - SSL配置组件应该显示平台信息

## 验证清单

### 功能验证
- [ ] SSL警告对话框正确显示
- [ ] 用户选择"继续连接"后能正常访问
- [ ] 用户选择"取消连接"后请求被中断
- [ ] SSL配置状态正确显示
- [ ] 宽松模式和安全模式切换正常

### 安全验证
- [ ] 警告信息清晰明确
- [ ] 用户必须明确选择才能继续
- [ ] 默认行为是拒绝不安全连接
- [ ] 有效证书的连接不受影响

### 兼容性验证
- [ ] Android不同版本兼容
- [ ] iOS不同版本兼容
- [ ] 不影响现有功能
- [ ] 向后兼容性保持

## 调试信息

### Android日志
```bash
adb logcat | grep -E "(SSLConfig|NetworkConfig|MainActivity)"
```

### iOS日志
在Xcode中查看控制台输出，搜索"SSLConfig"相关日志

### Web端调试
在浏览器开发者工具中查看控制台，搜索"SSLConfig"相关日志

## 常见问题

### 1. 对话框不显示
- 检查插件是否正确注册
- 确认网络请求确实失败
- 查看日志确认错误类型

### 2. 用户选择后仍然连接失败
- 检查SSL配置是否正确应用
- 确认服务器证书问题类型
- 验证网络连接状态

### 3. 影响正常HTTPS连接
- 确认只在SSL验证失败时触发
- 检查默认SSL配置是否被意外修改
- 验证有效证书的连接流程