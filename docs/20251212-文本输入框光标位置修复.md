# 文本输入框光标位置修复

## 问题描述
前端智能记账窗口和编辑记账页面的文本输入控件无法在文本中间插入字符，只能在末尾追加。

## 根本原因
React受控组件的典型问题：每次输入触发setState → 组件重新渲染 → 光标被重置到末尾。

## 解决方案
使用ref保存和恢复光标位置：
1. 在onChange时保存光标位置（selectionStart）
2. 在useEffect中监听value变化，恢复光标位置（setSelectionRange）

## 修复的文件
1. `apps/web/src/components/transactions/smart-accounting-dialog.tsx` - 智能记账对话框
2. `apps/web/src/components/transactions/enhanced-smart-accounting-dialog.tsx` - 增强版智能记账对话框
3. `apps/web/src/components/transactions/smart-accounting-input.tsx` - 智能记账输入组件
4. `apps/web/src/components/transactions/transaction-details.tsx` - 记账详情页面
5. `apps/web/src/app/transactions/edit/[id]/transaction-edit-client.tsx` - 编辑记账页面

## 技术实现
```tsx
// 添加ref和状态
const inputRef = useRef<HTMLInputElement>(null);
const [cursorPosition, setCursorPosition] = useState<number | null>(null);

// 恢复光标位置
useEffect(() => {
  if (inputRef.current && cursorPosition !== null) {
    inputRef.current.setSelectionRange(cursorPosition, cursorPosition);
  }
}, [description, cursorPosition]);

// 修改onChange处理
<input
  ref={inputRef}
  value={description}
  onChange={(e) => {
    const target = e.target;
    setCursorPosition(target.selectionStart);
    setDescription(target.value);
  }}
/>
```

## 测试建议
1. 在文本中间点击定位光标
2. 输入字符，验证光标保持在插入位置
3. 使用方向键移动光标后输入
4. 选中部分文字后输入替换
