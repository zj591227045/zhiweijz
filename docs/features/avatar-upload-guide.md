# å¤´åƒä¸Šä¼ åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å¤´åƒä¸Šä¼ åŠŸèƒ½æ”¯æŒç”¨æˆ·é€šè¿‡å¤šç§æ–¹å¼è®¾ç½®ä¸ªäººå¤´åƒï¼ŒåŒ…æ‹¬é¢„è®¾å¤´åƒé€‰æ‹©å’Œè‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ã€‚è¯¥åŠŸèƒ½å…·æœ‰å®Œæ•´çš„å‘åå…¼å®¹æ€§ï¼Œå¹¶æ”¯æŒå¤šå¹³å°ä½¿ç”¨ã€‚

## ğŸš€ ä¸»è¦ç‰¹æ€§

### 1. å‘åå…¼å®¹æ€§
- âœ… ä¿ç•™åŸæœ‰é¢„è®¾å¤´åƒé€‰æ‹©åŠŸèƒ½
- âœ… å½“æ–‡ä»¶å­˜å‚¨æœªå¯ç”¨æ—¶ï¼Œè‡ªåŠ¨å›é€€åˆ°é¢„è®¾å¤´åƒæ¨¡å¼
- âœ… æ”¯æŒç°æœ‰å¤´åƒæ•°æ®çš„æ— ç¼è¿ç§»

### 2. å¤šå¹³å°æ”¯æŒ
- **Webç«¯ï¼ˆæ¡Œé¢ï¼‰**ï¼šæ”¯æŒç‚¹å‡»ä¸Šä¼ ã€æ‹–æ‹½ä¸Šä¼ 
- **Webç«¯ï¼ˆç§»åŠ¨ï¼‰**ï¼šæ”¯æŒç‚¹å‡»ä¸Šä¼ ã€è°ƒç”¨è®¾å¤‡ç›¸æœº/ç›¸å†Œ
- **iOSåŸç”Ÿåº”ç”¨**ï¼šæ”¯æŒCapacitorç›¸æœºå’Œç›¸å†Œæ’ä»¶
- **AndroidåŸç”Ÿåº”ç”¨**ï¼šæ”¯æŒCapacitorç›¸æœºå’Œç›¸å†Œæ’ä»¶

### 3. æ™ºèƒ½å›¾ç‰‡å¤„ç†
- ğŸ–¼ï¸ è‡ªåŠ¨å›¾ç‰‡å‹ç¼©å’Œä¼˜åŒ–
- âœ‚ï¸ åœ†å½¢å¤´åƒè£å‰ªåŠŸèƒ½
- ğŸ“ æ™ºèƒ½å°ºå¯¸è°ƒæ•´ï¼ˆæœ€å¤§1024x1024ï¼‰
- ğŸ—œï¸ è‡ªé€‚åº”å‹ç¼©è´¨é‡ï¼ˆæ ¹æ®æ–‡ä»¶å¤§å°ï¼‰

### 4. å®Œå–„çš„ç”¨æˆ·ä½“éªŒ
- ğŸ“Š å®æ—¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- âš ï¸ è¯¦ç»†é”™è¯¯æç¤ºå’Œå¤„ç†
- ğŸ”’ æƒé™æ£€æŸ¥å’Œå¼•å¯¼
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§å±å¹•

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **AvatarUploader** - ä¸»è¦å¤´åƒä¸Šä¼ ç»„ä»¶
2. **ImageCropper** - å›¾ç‰‡è£å‰ªç»„ä»¶
3. **UploadProgress** - ä¸Šä¼ è¿›åº¦æŒ‡ç¤ºå™¨
4. **PlatformFilePicker** - è·¨å¹³å°æ–‡ä»¶é€‰æ‹©å™¨

### å…³é”®æŠ€æœ¯

- **æ–‡ä»¶å­˜å‚¨çŠ¶æ€æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹S3å­˜å‚¨é…ç½®çŠ¶æ€
- **å¹³å°èƒ½åŠ›æ£€æµ‹**ï¼šåŠ¨æ€æ£€æµ‹è®¾å¤‡ç›¸æœºã€ç›¸å†Œæ”¯æŒ
- **æƒé™ç®¡ç†**ï¼šç»Ÿä¸€çš„æƒé™è¯·æ±‚å’Œå¤„ç†æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé˜²æŠ–ã€èŠ‚æµã€æ™ºèƒ½å‹ç¼©ç­‰ä¼˜åŒ–ç­–ç•¥

## ğŸ“– ä½¿ç”¨è¯´æ˜

### ç®¡ç†å‘˜é…ç½®

1. **å¯ç”¨æ–‡ä»¶å­˜å‚¨æœåŠ¡**
   ```
   è¿›å…¥ç®¡ç†åå° â†’ å­˜å‚¨ç®¡ç† â†’ é…ç½®S3å­˜å‚¨
   ```

2. **é…ç½®å­˜å‚¨æ¡¶**
   - å¤´åƒå­˜å‚¨æ¡¶ï¼š`avatars`
   - é™„ä»¶å­˜å‚¨æ¡¶ï¼š`transaction-attachments`
   - ä¸´æ—¶æ–‡ä»¶æ¡¶ï¼š`temp-files`

### ç”¨æˆ·ä½¿ç”¨æµç¨‹

1. **è®¿é—®ä¸ªäººèµ„æ–™é¡µé¢**
   ```
   è®¾ç½® â†’ ä¸ªäººèµ„æ–™ â†’ ç‚¹å‡»å¤´åƒ
   ```

2. **é€‰æ‹©å¤´åƒæ¥æº**
   - ğŸ“· æ‹ç…§ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰
   - ğŸ–¼ï¸ ä»ç›¸å†Œé€‰æ‹©
   - ğŸ¨ é€‰æ‹©é¢„è®¾å¤´åƒ

3. **å›¾ç‰‡å¤„ç†**
   - è‡ªåŠ¨æ˜¾ç¤ºè£å‰ªç•Œé¢
   - æ‹–æ‹½è°ƒæ•´è£å‰ªåŒºåŸŸ
   - ç¡®è®¤è£å‰ªå¹¶ä¸Šä¼ 

## ğŸ”§ å¼€å‘æŒ‡å—

### é›†æˆå¤´åƒä¸Šä¼ ç»„ä»¶

```tsx
import { AvatarUploader } from '@/components/profile/avatar-uploader';

function ProfilePage() {
  const handleAvatarChange = (avatarData) => {
    if (avatarData.type === 'preset') {
      // å¤„ç†é¢„è®¾å¤´åƒ
      updateAvatarId(avatarData.data.id);
    } else {
      // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
      uploadAvatar(avatarData.data);
    }
  };

  return (
    <AvatarUploader
      currentAvatar={user.avatar}
      username={user.username}
      onAvatarChange={handleAvatarChange}
      isUploading={isUploading}
    />
  );
}
```

### è‡ªå®šä¹‰æ–‡ä»¶éªŒè¯

```typescript
import { validateAvatarFile } from '@/lib/file-upload-utils';

const validation = validateAvatarFile(file);
if (!validation.valid) {
  console.error(validation.error);
}
```

### å¹³å°èƒ½åŠ›æ£€æµ‹

```typescript
import { platformFilePicker } from '@/lib/platform-file-picker';

const capabilities = await platformFilePicker.checkCapabilities();
console.log('æ”¯æŒç›¸æœº:', capabilities.hasCamera);
console.log('æ”¯æŒç›¸å†Œ:', capabilities.hasGallery);
```

## ğŸ“± ç§»åŠ¨ç«¯ç‰¹æ®Šé…ç½®

### iOSé…ç½®

åœ¨ `ios/App/App/Info.plist` ä¸­æ·»åŠ æƒé™ï¼š

```xml
<key>NSCameraUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸æœºæ¥æ‹æ‘„å¤´åƒ</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸å†Œæ¥é€‰æ‹©å¤´åƒ</string>
```

### Androidé…ç½®

åœ¨ `android/app/src/main/AndroidManifest.xml` ä¸­æ·»åŠ æƒé™ï¼š

```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¸å¯ç”¨**
   - æ£€æŸ¥S3å­˜å‚¨é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤å­˜å‚¨æ¡¶æ˜¯å¦å­˜åœ¨ä¸”å¯è®¿é—®
   - éªŒè¯ç½‘ç»œè¿æ¥çŠ¶æ€

2. **ç›¸æœº/ç›¸å†Œæ— æ³•è®¿é—®**
   - æ£€æŸ¥è®¾å¤‡æƒé™è®¾ç½®
   - ç¡®è®¤Capacitoræ’ä»¶æ˜¯å¦æ­£ç¡®å®‰è£…
   - éªŒè¯å¹³å°å…¼å®¹æ€§

3. **å›¾ç‰‡å‹ç¼©å¤±è´¥**
   - æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
   - ç¡®è®¤æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ
   - éªŒè¯æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```typescript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   console.log('ğŸ“· æ‹ç…§æˆåŠŸ:', result);
   console.log('ğŸ—œï¸ å‹ç¼©å®Œæˆ:', processedFile);
   ```

2. **æ€§èƒ½ç›‘æ§**
   ```typescript
   import { PerformanceTimer } from '@/lib/performance-utils';
   
   const timer = new PerformanceTimer();
   timer.start('upload');
   // ... ä¸Šä¼ æ“ä½œ
   console.log('ä¸Šä¼ è€—æ—¶:', timer.end('upload'), 'ms');
   ```

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åŸºç¡€å¤´åƒä¸Šä¼ åŠŸèƒ½
- âœ… å¤šå¹³å°æ”¯æŒ
- âœ… å›¾ç‰‡è£å‰ªå’Œå‹ç¼©
- âœ… è¿›åº¦æŒ‡ç¤ºå’Œé”™è¯¯å¤„ç†

### è®¡åˆ’åŠŸèƒ½
- ğŸ”„ æ‰¹é‡å¤´åƒä¸Šä¼ 
- ğŸ¨ æ›´å¤šè£å‰ªå½¢çŠ¶é€‰é¡¹
- ğŸ“Š ä¸Šä¼ ç»Ÿè®¡å’Œåˆ†æ
- ğŸ”— ç¤¾äº¤å¹³å°å¤´åƒåŒæ­¥

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œå­˜å‚¨é…ç½®
3. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
