# 只为记账 - 前端技术选型与架构设计

## 1. 技术选型

### 1.1 核心框架: Next.js (React)

选择 Next.js 作为核心框架的理由:

- **服务端渲染 (SSR) 和静态站点生成 (SSG)**: 提高首屏加载速度和SEO表现
- **路由系统**: 内置的文件系统路由简化了路由配置
- **API路由**: 可以在同一项目中创建API端点，简化前后端交互
- **React生态系统**: 利用React丰富的组件生态和社区支持
- **TypeScript支持**: 提供良好的类型安全和开发体验
- **增量静态再生成**: 允许在不重新构建整个站点的情况下更新静态内容

### 1.2 状态管理: Zustand

选择 Zustand 的理由:

- **简单轻量**: API简洁，学习曲线平缓
- **基于钩子**: 与React的函数组件模型完美契合
- **不需要Provider**: 减少了样板代码
- **支持中间件**: 可扩展性强，支持持久化、日志等功能
- **TypeScript友好**: 提供良好的类型推断
- **性能优化**: 内置的选择性更新机制，减少不必要的重渲染

### 1.3 UI组件库: Shadcn UI + Tailwind CSS

选择 Shadcn UI + Tailwind CSS 的理由:

- **高度可定制**: Shadcn UI提供可复制的组件代码，而非黑盒组件
- **无运行时依赖**: 组件直接集成到项目代码中，便于定制
- **原子化CSS**: Tailwind的原子类方法提高开发效率
- **响应式设计**: Tailwind内置的响应式工具简化移动优先设计
- **主题系统**: 通过CSS变量和Tailwind配置实现强大的主题系统
- **暗模式支持**: 内置暗模式切换功能

### 1.4 表单处理: React Hook Form + Zod

选择 React Hook Form + Zod 的理由:

- **性能优化**: 非受控组件模式减少重渲染
- **验证集成**: 与Zod无缝集成，提供类型安全的表单验证
- **错误处理**: 强大的错误处理和展示机制
- **TypeScript支持**: 自动类型推断减少类型定义工作
- **轻量级**: 最小化包体积，优化加载性能

### 1.5 HTTP客户端: Axios + React Query

选择 Axios + React Query 的理由:

- **请求缓存**: React Query提供智能缓存，减少重复请求
- **数据同步**: 自动后台数据刷新和乐观更新
- **加载和错误状态**: 统一处理请求状态
- **请求拦截**: Axios拦截器便于处理认证和错误
- **TypeScript支持**: 类型安全的API调用
- **并发控制**: 请求去重和重试机制

### 1.6 图表库: Chart.js + React-Chartjs-2

选择 Chart.js + React-Chartjs-2 的理由:

- **轻量级**: 相比其他图表库体积小
- **响应式**: 自适应容器大小
- **动画效果**: 流畅的数据可视化动画
- **交互性**: 支持悬停、点击等交互事件
- **定制性**: 高度可定制的外观和行为
- **React集成**: React-Chartjs-2提供React友好的API

### 1.7 工具库

- **日期处理**: Day.js (轻量级日期库)
- **国际化**: next-intl (Next.js国际化解决方案)
- **工具函数**: lodash-es (按需导入的工具函数)
- **动画**: Framer Motion (React动画库)
- **图标**: Lucide React (一致性图标集)

### 1.8 主题系统: Tailwind CSS + CSS变量

选择 Tailwind CSS + CSS变量 构建主题系统的理由:

- **灵活性**: 通过CSS变量实现动态主题切换，无需重新加载页面
- **性能优化**: 主题切换仅涉及CSS变量更新，不触发组件重渲染
- **可扩展性**: 支持无限数量的主题，便于后续添加主题商店功能
- **开发体验**: 与Tailwind无缝集成，保持一致的开发体验
- **主题继承**: 支持主题继承和覆盖，便于创建主题变体
- **类型安全**: 通过TypeScript确保主题配置的类型安全

## 2. 架构设计

### 2.1 项目结构

```
client/
├── public/                # 静态资源
│   ├── fonts/            # 字体文件
│   ├── images/           # 图片资源
│   └── locales/          # 国际化文本
│
├── src/
│   ├── app/              # Next.js App Router
│   │   ├── (auth)/       # 认证相关页面
│   │   ├── (dashboard)/  # 已认证用户页面
│   │   ├── api/          # API路由
│   │   └── layout.tsx    # 根布局
│   │
│   ├── components/       # 组件
│   │   ├── ui/           # 基础UI组件
│   │   ├── auth/         # 认证相关组件
│   │   ├── dashboard/    # 仪表盘组件
│   │   ├── transactions/ # 交易相关组件
│   │   ├── categories/   # 分类相关组件
│   │   ├── budgets/      # 预算相关组件
│   │   ├── statistics/   # 统计分析组件
│   │   ├── family/       # 家庭账本组件
│   │   ├── settings/     # 设置相关组件
│   │   └── shared/       # 共享组件
│   │
│   ├── hooks/            # 自定义钩子
│   │   ├── use-auth.ts   # 认证钩子
│   │   ├── use-toast.ts  # 通知钩子
│   │   └── use-form.ts   # 表单钩子
│   │
│   ├── lib/              # 工具库
│   │   ├── api.ts        # API客户端
│   │   ├── utils.ts      # 工具函数
│   │   ├── validators.ts # 验证函数
│   │   └── constants.ts  # 常量定义
│   │
│   ├── store/            # 状态管理
│   │   ├── auth-store.ts # 认证状态
│   │   ├── transaction-store.ts # 交易状态
│   │   └── ui-store.ts   # UI状态
│   │
│   ├── styles/           # 样式文件
│   │   ├── globals.css   # 全局样式
│   │   └── themes/       # 主题定义
│   │       ├── base.ts   # 基础主题变量
│   │       ├── default/  # 默认主题
│   │       ├── dark/     # 暗色主题
│   │       ├── blue/     # 蓝色主题
│   │       ├── green/    # 绿色主题
│   │       ├── purple/   # 紫色主题
│   │       └── custom/   # 自定义主题
│   │
│   └── types/            # 类型定义
│       ├── api.ts        # API类型
│       ├── models.ts     # 数据模型类型
│       ├── common.ts     # 通用类型
│       └── theme.ts      # 主题类型定义
│
├── .env.local            # 本地环境变量
├── .env.production       # 生产环境变量
├── next.config.js        # Next.js配置
├── tailwind.config.js    # Tailwind配置
└── tsconfig.json         # TypeScript配置
```

### 2.2 状态管理架构

采用分层状态管理策略:

1. **本地组件状态**: 使用React的useState和useReducer管理组件内部状态
2. **共享UI状态**: 使用Zustand存储全局UI状态(侧边栏状态、模态框状态等)
3. **主题状态**: 使用专门的Zustand store管理主题选择和自定义主题
4. **业务领域状态**: 使用Zustand按功能模块划分状态库
5. **服务器状态**: 使用React Query管理API数据，处理缓存和同步

#### 主题状态管理

主题状态管理采用独立的Zustand store:

```typescript
// store/theme-store.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { Theme, ThemeType } from '../types/theme';
import { defaultTheme, darkTheme, blueTheme, greenTheme, purpleTheme } from '../styles/themes';

interface ThemeState {
  // 当前激活的主题
  activeTheme: ThemeType;
  // 可用的内置主题
  builtinThemes: Record<string, Theme>;
  // 用户自定义主题
  customThemes: Record<string, Theme>;
  // 设置当前主题
  setTheme: (themeType: ThemeType) => void;
  // 添加自定义主题
  addCustomTheme: (name: string, theme: Theme) => void;
  // 更新自定义主题
  updateCustomTheme: (name: string, theme: Theme) => void;
  // 删除自定义主题
  removeCustomTheme: (name: string) => void;
}

export const useThemeStore = create<ThemeState>()(
  persist(
    (set) => ({
      activeTheme: 'default',
      builtinThemes: {
        default: defaultTheme,
        dark: darkTheme,
        blue: blueTheme,
        green: greenTheme,
        purple: purpleTheme,
      },
      customThemes: {},

      setTheme: (themeType) => set({ activeTheme: themeType }),

      addCustomTheme: (name, theme) => set((state) => ({
        customThemes: { ...state.customThemes, [name]: theme }
      })),

      updateCustomTheme: (name, theme) => set((state) => ({
        customThemes: { ...state.customThemes, [name]: theme }
      })),

      removeCustomTheme: (name) => set((state) => {
        const newCustomThemes = { ...state.customThemes };
        delete newCustomThemes[name];
        return { customThemes: newCustomThemes };
      }),
    }),
    {
      name: 'theme-storage',
      partialize: (state) => ({
        activeTheme: state.activeTheme,
        customThemes: state.customThemes,
      }),
    }
  )
);

### 2.3 路由设计

基于Next.js的App Router实现路由:

```
/                   # 首页/登录页
/register           # 注册页
/forgot-password    # 忘记密码
/reset-password     # 重置密码
/dashboard          # 仪表盘
/transactions       # 交易列表
/transactions/new   # 新建交易
/transactions/:id   # 交易详情
/categories         # 分类管理
/budgets            # 预算管理
/budgets/new        # 新建预算
/budgets/:id        # 预算详情
/statistics         # 统计分析
/family             # 家庭账本
/family/new         # 创建家庭
/family/:id         # 家庭详情
/family/:id/members # 家庭成员管理
/family/join/:code  # 接受邀请
/settings           # 用户设置
/settings/profile   # 个人资料
/settings/account   # 账户设置
/settings/books     # 账本管理
/settings/themes    # 主题设置
/settings/themes/editor # 主题编辑器
/settings/themes/import # 主题导入
```

### 2.4 API请求处理策略

1. **API客户端**: 使用Axios创建基础API客户端，配置拦截器处理认证和错误
2. **数据获取**: 使用React Query的useQuery钩子获取和缓存数据
3. **数据修改**: 使用React Query的useMutation钩子处理数据修改
4. **错误处理**: 全局错误处理中间件，统一展示错误通知
5. **认证**: 请求拦截器自动添加认证令牌，响应拦截器处理401错误
6. **缓存策略**: 根据数据类型设置不同的缓存时间和失效策略

### 2.5 响应式设计方案

采用移动优先的响应式设计:

1. **断点设计**:
   - xs: 0-639px (手机)
   - sm: 640px-767px (大手机)
   - md: 768px-1023px (平板)
   - lg: 1024px-1279px (小笔记本)
   - xl: 1280px+ (桌面)

2. **布局策略**:
   - 移动端: 单列布局，底部导航栏
   - 平板/桌面: 侧边栏导航 + 主内容区

3. **组件适应**:
   - 使用Tailwind的响应式前缀(sm:, md:, lg:)
   - 关键组件设计多种布局变体
   - 使用CSS Grid和Flexbox创建灵活布局
