# 只为记账 - 界面设计与功能实现

本文档详细描述各个页面的布局、组件、交互与实现方案。

## 1. 认证模块

### 1.1 登录页 (`/login`)

**布局设计**:
- 顶部品牌标识和应用名称
- 中部登录表单
- 底部注册和忘记密码链接

**组件构成**:
- `LoginForm`: 包含邮箱输入框、密码输入框和登录按钮
- `AuthLayout`: 认证页面通用布局
- `FormInput`: 带验证的输入框组件
- `PasswordInput`: 带显示/隐藏切换的密码输入框

**交互流程**:
1. 用户输入邮箱和密码
2. 表单验证邮箱格式和密码长度
3. 提交表单，显示加载状态
4. 登录成功后重定向到仪表盘，失败则显示错误信息

**实现要点**:
- 使用React Hook Form处理表单状态和验证
- 使用Zod定义验证规则
- 登录API调用使用React Query的useMutation
- 登录成功后将令牌存储在安全的Cookie中
- 实现"记住我"功能，延长令牌有效期

### 1.2 注册页 (`/register`)

**布局设计**:
- 与登录页类似的布局
- 分步注册流程

**组件构成**:
- `RegisterForm`: 多步注册表单
- `StepIndicator`: 显示当前注册步骤
- `TermsAgreement`: 用户协议同意组件

**交互流程**:
1. 第一步: 输入邮箱、密码和确认密码
2. 第二步: 输入用户名和其他基本信息
3. 第三步: 阅读并同意用户协议
4. 提交注册，成功后自动登录并重定向

**实现要点**:
- 使用状态管理多步表单
- 实时验证邮箱是否已被注册
- 密码强度指示器
- 注册成功后自动创建默认账本

### 1.3 密码找回页 (`/forgot-password`)

**布局设计**:
- 简洁的表单布局
- 邮箱输入和提交按钮

**组件构成**:
- `ForgotPasswordForm`: 邮箱输入表单
- `SuccessMessage`: 提交成功后的提示

**交互流程**:
1. 用户输入注册邮箱
2. 提交后显示确认信息
3. 用户收到邮件并点击重置链接

**实现要点**:
- 防止频繁请求的限流措施
- 成功提交后的引导说明
- 邮箱模糊处理，保护用户隐私

## 2. 主界面

### 2.1 仪表盘 (`/dashboard`)

**布局设计**:
- 顶部导航栏: 标题、通知和设置按钮
- 本月概览卡片: 收入、支出和结余
- 预算执行情况: 进度条显示各类别预算使用情况
- 最近交易列表: 分组显示最近的交易记录
- 底部导航栏: 首页、统计、添加、预算、我的

**组件构成**:
- `DashboardLayout`: 包含顶部和底部导航的布局
- `BalanceCard`: 显示本月财务概览
- `BudgetProgressList`: 预算执行进度列表
- `TransactionList`: 分组交易列表
- `BottomNavigation`: 底部导航栏

**交互流程**:
1. 页面加载时获取本月概览数据
2. 获取活跃预算和执行情况
3. 获取最近交易记录
4. 点击交易项可查看详情
5. 点击预算项可查看预算详情

**实现要点**:
- 使用React Query并行获取多个数据源
- 实现下拉刷新功能
- 交易列表使用虚拟滚动优化性能
- 数据加载状态的骨架屏展示

### 2.2 全局布局

**布局设计**:
- 移动端: 顶部标题栏 + 内容区 + 底部导航
- 平板/桌面端: 侧边导航 + 顶部标题栏 + 内容区

**组件构成**:
- `AppLayout`: 应用全局布局
- `TopBar`: 顶部标题栏
- `BottomNav`: 底部导航栏
- `SideNav`: 侧边导航栏(平板/桌面)
- `PageContainer`: 页面内容容器

**交互流程**:
1. 根据屏幕尺寸自动切换布局
2. 导航项高亮显示当前页面
3. 底部导航中间的添加按钮打开快速添加交易界面

**实现要点**:
- 使用媒体查询实现响应式布局
- 导航状态与路由同步
- 平滑的布局切换动画

## 3. 交易管理

### 3.1 交易列表页 (`/transactions`)

**布局设计**:
- 顶部筛选栏: 时间范围、类型、分类筛选
- 交易列表: 按日期分组的交易记录
- 悬浮添加按钮

**组件构成**:
- `TransactionFilters`: 筛选条件组件
- `GroupedTransactionList`: 分组交易列表
- `TransactionItem`: 单个交易项
- `FloatingActionButton`: 悬浮添加按钮

**交互流程**:
1. 加载交易数据，默认显示最近一个月
2. 用户可应用筛选条件
3. 支持下拉刷新和上拉加载更多
4. 点击交易项查看/编辑详情

**实现要点**:
- 实现无限滚动加载
- 筛选条件与URL参数同步
- 列表项滑动操作(编辑/删除)
- 交易数据的本地缓存

### 3.2 添加交易页 (`/transactions/new`)

**布局设计**:
- 分步式流程:
  1. 选择交易类型(收入/支出)
  2. 输入金额
  3. 选择分类
  4. 填写详情

**组件构成**:
- `TransactionTypeToggle`: 收入/支出切换
- `AmountInput`: 金额输入键盘
- `CategoryGrid`: 分类网格选择器
- `TransactionDetailsForm`: 交易详情表单

**交互流程**:
1. 用户选择交易类型
2. 输入金额后显示分类选择
3. 选择分类后显示详情表单
4. 填写描述、日期、时间等信息
5. 提交表单创建交易

**实现要点**:
- 自定义数字键盘组件
- 分类网格的动态加载
- 表单状态在步骤间保持
- 快速添加模式(简化流程)

### 3.3 交易详情页 (`/transactions/:id`)

**布局设计**:
- 顶部操作栏: 返回、编辑、删除
- 交易基本信息卡片
- 详细信息列表
- 底部编辑按钮

**组件构成**:
- `TransactionHeader`: 显示金额和类型
- `TransactionDetails`: 详细信息组件
- `ActionButtons`: 操作按钮组

**交互流程**:
1. 加载交易详情数据
2. 显示交易的所有相关信息
3. 提供编辑和删除操作

**实现要点**:
- 优化数据加载体验
- 删除操作的确认机制
- 编辑后的数据同步

## 4. 分类管理

### 4.1 分类列表页 (`/categories`)

**布局设计**:
- 顶部类型切换: 支出/收入分类
- 分类网格/列表视图
- 添加分类按钮

**组件构成**:
- `CategoryTypeToggle`: 类型切换组件
- `CategoryGrid`: 网格视图
- `CategoryList`: 列表视图
- `AddCategoryButton`: 添加按钮

**交互流程**:
1. 加载用户分类数据
2. 切换显示支出或收入分类
3. 长按分类项进入编辑模式
4. 点击添加按钮创建新分类

**实现要点**:
- 支持拖拽排序
- 区分系统默认分类和用户自定义分类
- 分类图标选择器

### 4.2 添加/编辑分类 (`/categories/new`, `/categories/:id/edit`)

**布局设计**:
- 表单布局: 名称、图标、类型字段
- 图标选择网格

**组件构成**:
- `CategoryForm`: 分类表单
- `IconPicker`: 图标选择器
- `ColorPicker`: 颜色选择器

**交互流程**:
1. 创建模式: 空表单
2. 编辑模式: 预填充现有数据
3. 选择图标和颜色
4. 提交保存分类

**实现要点**:
- 丰富的图标库
- 自定义颜色选择
- 名称唯一性验证

## 5. 预算管理

### 5.1 预算列表页 (`/budgets`)

**布局设计**:
- 当前预算周期选择器
- 总体预算进度条
- 分类预算卡片列表
- 添加预算按钮

**组件构成**:
- `BudgetPeriodSelector`: 周期选择器
- `TotalBudgetProgress`: 总预算进度
- `CategoryBudgetCard`: 分类预算卡片
- `AddBudgetButton`: 添加预算按钮

**交互流程**:
1. 加载当前周期的预算数据
2. 显示总体和分类预算使用情况
3. 点击预算卡片查看详情
4. 点击添加按钮创建新预算

**实现要点**:
- 预算周期的灵活切换
- 预算超支警告
- 预算使用趋势分析

### 5.2 预算详情页 (`/budgets/:id`)

**布局设计**:
- 预算基本信息
- 使用进度和趋势图
- 相关交易列表
- 编辑按钮

**组件构成**:
- `BudgetHeader`: 预算名称和金额
- `BudgetProgress`: 详细进度信息
- `BudgetTrendChart`: 使用趋势图表
- `RelatedTransactions`: 相关交易列表

**交互流程**:
1. 加载预算详情和相关交易
2. 显示使用进度和趋势
3. 查看关联的交易记录
4. 提供编辑和删除操作

**实现要点**:
- 动态计算预算使用趋势
- 相关交易的筛选和分页
- 预算调整建议

### 5.3 创建/编辑预算页 (`/budgets/new`, `/budgets/:id/edit`)

**布局设计**:
- 表单布局: 名称、金额、周期、分类等字段
- 预算周期选择器
- 分类选择器

**组件构成**:
- `BudgetForm`: 预算表单
- `PeriodSelector`: 周期选择组件
- `AmountInput`: 金额输入组件
- `CategorySelector`: 分类选择组件

**交互流程**:
1. 创建模式: 空表单
2. 编辑模式: 预填充现有数据
3. 选择预算周期和分类
4. 设置预算金额
5. 提交保存预算

**实现要点**:
- 智能预算建议
- 历史预算数据参考
- 周期起止日期计算

## 6. 统计分析

### 6.1 统计概览页 (`/statistics`)

**布局设计**:
- 时间范围选择器
- 收支概览卡片
- 分类占比饼图
- 趋势折线图
- 详细统计入口

**组件构成**:
- `DateRangePicker`: 时间范围选择器
- `StatsSummaryCard`: 统计概览卡片
- `CategoryPieChart`: 分类占比图表
- `TrendLineChart`: 趋势折线图
- `StatsNavigation`: 详细统计导航

**交互流程**:
1. 加载默认时间范围(当月)的统计数据
2. 用户可调整时间范围
3. 查看不同维度的统计图表
4. 点击图表元素查看详情

**实现要点**:
- 图表的交互性和动画效果
- 统计数据的缓存策略
- 图表颜色与分类颜色一致

### 6.2 分类分析页 (`/statistics/categories`)

**布局设计**:
- 分类筛选器
- 分类消费排行榜
- 分类趋势对比图
- 分类详情列表

**组件构成**:
- `CategoryFilter`: 分类筛选组件
- `CategoryRanking`: 排行榜组件
- `CategoryComparisonChart`: 对比图表
- `CategoryDetailList`: 详情列表

**交互流程**:
1. 加载分类统计数据
2. 用户可筛选特定分类
3. 查看分类消费排行
4. 分析分类消费趋势

**实现要点**:
- 多维度排序(金额、频率)
- 同比/环比分析
- 异常消费检测

### 6.3 预算执行分析页 (`/statistics/budgets`)

**布局设计**:
- 预算周期选择器
- 预算执行概览
- 预算执行历史图表
- 预算调整建议

**组件构成**:
- `BudgetPeriodSelector`: 周期选择器
- `BudgetExecutionSummary`: 执行概览
- `BudgetHistoryChart`: 历史执行图表
- `BudgetRecommendations`: 调整建议

**交互流程**:
1. 加载预算执行数据
2. 分析预算执行情况
3. 查看历史执行趋势
4. 获取智能调整建议

**实现要点**:
- 预算执行率计算
- 历史数据比较分析
- 基于消费模式的预算建议

## 7. 账本管理

### 7.1 账本列表页 (`/books`)

**布局设计**:
- 账本卡片列表
- 当前账本标识
- 添加账本按钮

**组件构成**:
- `BookList`: 账本列表
- `BookCard`: 账本卡片
- `AddBookButton`: 添加按钮

**交互流程**:
1. 加载用户的所有账本
2. 显示当前激活的账本
3. 点击账本卡片切换账本
4. 点击添加按钮创建新账本

**实现要点**:
- 账本切换的状态同步
- 默认账本标识
- 账本缩略信息展示

### 7.2 账本详情页 (`/books/:id`)

**布局设计**:
- 账本基本信息
- 账本统计概览
- 账本设置选项
- 删除账本按钮

**组件构成**:
- `BookHeader`: 账本名称和描述
- `BookStatistics`: 统计概览
- `BookSettings`: 设置选项
- `DeleteBookButton`: 删除按钮

**交互流程**:
1. 加载账本详细信息
2. 显示账本统计数据
3. 提供账本设置选项
4. 确认后删除账本

**实现要点**:
- 防止误删的确认机制
- 默认账本不可删除
- 账本数据导出功能

### 7.3 创建/编辑账本页 (`/books/new`, `/books/:id/edit`)

**布局设计**:
- 表单布局: 名称、描述、设置等字段
- AI服务配置选项

**组件构成**:
- `BookForm`: 账本表单
- `AIServiceConfig`: AI服务配置组件

**交互流程**:
1. 创建模式: 空表单
2. 编辑模式: 预填充现有数据
3. 配置账本基本信息
4. 设置AI服务选项
5. 提交保存账本

**实现要点**:
- AI服务提供商选择
- API密钥安全存储
- 默认账本设置

## 8. 家庭账本

### 8.1 家庭列表页 (`/families`)

**布局设计**:
- 家庭卡片列表
- 创建家庭按钮
- 加入家庭按钮

**组件构成**:
- `FamilyList`: 家庭列表
- `FamilyCard`: 家庭卡片
- `CreateFamilyButton`: 创建按钮
- `JoinFamilyButton`: 加入按钮

**交互流程**:
1. 加载用户所属的所有家庭
2. 点击家庭卡片进入家庭详情
3. 点击创建按钮新建家庭
4. 点击加入按钮输入邀请码

**实现要点**:
- 家庭角色权限管理
- 家庭切换的状态同步
- 邀请码验证机制

### 8.2 家庭详情页 (`/families/:id`)

**布局设计**:
- 家庭基本信息
- 成员列表
- 家庭统计概览
- 设置和管理选项

**组件构成**:
- `FamilyHeader`: 家庭名称和信息
- `MemberList`: 成员列表
- `FamilyStatistics`: 统计概览
- `FamilyManagement`: 管理选项

**交互流程**:
1. 加载家庭详细信息和成员
2. 显示家庭财务统计
3. 管理员可访问设置选项
4. 生成邀请链接添加成员

**实现要点**:
- 基于角色的界面适配
- 成员消费分析比较
- 邀请链接生成和管理

### 8.3 家庭成员管理页 (`/families/:id/members`)

**布局设计**:
- 成员列表
- 角色管理选项
- 邀请新成员功能
- 移除成员选项

**组件构成**:
- `MemberManagementList`: 成员管理列表
- `RoleSelector`: 角色选择组件
- `InvitationGenerator`: 邀请生成器
- `RemoveMemberButton`: 移除按钮

**交互流程**:
1. 加载家庭成员列表
2. 管理员可修改成员角色
3. 生成邀请链接或二维码
4. 确认后移除成员

**实现要点**:
- 角色权限管理
- 邀请链接有效期设置
- 成员移除的数据处理

## 9. 用户设置

### 9.1 设置页 (`/settings`)

**布局设计**:
- 用户信息卡片
- 设置选项列表
- 退出登录按钮

**组件构成**:
- `UserInfoCard`: 用户信息卡片
- `SettingsList`: 设置选项列表
- `LogoutButton`: 退出按钮

**交互流程**:
1. 显示用户基本信息
2. 提供各种设置入口
3. 确认后退出登录

**实现要点**:
- 设置项分类组织
- 用户头像上传
- 安全退出机制

### 9.2 个人资料页 (`/settings/profile`)

**布局设计**:
- 头像上传区域
- 个人信息表单
- 保存按钮

**组件构成**:
- `AvatarUploader`: 头像上传组件
- `ProfileForm`: 个人信息表单
- `SaveButton`: 保存按钮

**交互流程**:
1. 加载用户个人资料
2. 编辑个人信息
3. 上传或更换头像
4. 保存更改

**实现要点**:
- 图片裁剪和压缩
- 表单验证
- 实时保存反馈

### 9.3 账户安全页 (`/settings/security`)

**布局设计**:
- 密码修改表单
- 邮箱修改选项
- 安全设置选项

**组件构成**:
- `PasswordChangeForm`: 密码修改表单
- `EmailChangeOption`: 邮箱修改选项
- `SecuritySettings`: 安全设置选项

**交互流程**:
1. 验证当前密码
2. 设置新密码
3. 修改邮箱需验证
4. 配置其他安全选项

**实现要点**:
- 密码强度检测
- 邮箱验证流程
- 安全日志记录

### 9.4 主题设置页 (`/settings/themes`)

**布局设计**:
- 内置主题选择区域
- 当前主题预览卡片
- 自定义主题列表
- 主题编辑器
- 主题导入/导出按钮

**组件构成**:
- `ThemeSelector`: 主题选择组件
- `ThemePreviewCard`: 主题预览卡片
- `CustomThemeList`: 自定义主题列表
- `ThemeEditor`: 主题编辑器组件
- `ThemeImportExport`: 导入导出组件

**交互流程**:
1. 浏览并选择内置主题
2. 实时预览主题效果
3. 创建/编辑自定义主题
4. 导入/导出主题配置

**实现要点**:
- 主题实时预览
- 颜色选择器组件
- 主题配置的JSON导入/导出
- 主题配置验证
- 自定义主题的本地存储

### 9.5 主题编辑器页 (`/settings/themes/editor`)

**布局设计**:
- 主题名称输入
- 颜色选择面板
- 实时预览区域
- 保存/取消按钮

**组件构成**:
- `ThemeNameInput`: 主题名称输入组件
- `ColorPalette`: 颜色选择面板
- `LivePreview`: 实时预览组件
- `ActionButtons`: 操作按钮组

**交互流程**:
1. 输入自定义主题名称
2. 调整各个颜色变量
3. 实时查看效果
4. 保存或取消更改

**实现要点**:
- 颜色变量分组展示
- 对比度检查工具
- 预设颜色方案
- 主题继承机制
