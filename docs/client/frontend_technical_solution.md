# 只为记账 - 前端技术方案

## 1. 概述

本文档详细描述了"只为记账"应用的前端技术方案，包括技术选型、架构设计、UI/UX设计及实现细节。前端方案基于已实现的后端模块设计，旨在提供一个移动优先、用户友好的记账应用体验。

## 2. 技术选型

### 2.1 核心框架: Next.js (React)

选择 Next.js 作为核心框架的理由:

- **服务端渲染 (SSR) 和静态站点生成 (SSG)**: 提高首屏加载速度和SEO表现
- **路由系统**: 内置的文件系统路由简化了路由配置
- **API路由**: 可以在同一项目中创建API端点，简化前后端交互
- **React生态系统**: 利用React丰富的组件生态和社区支持
- **TypeScript支持**: 提供良好的类型安全和开发体验
- **增量静态再生成**: 允许在不重新构建整个站点的情况下更新静态内容

### 2.2 状态管理: Zustand

选择 Zustand 的理由:

- **简单轻量**: API简洁，学习曲线平缓
- **基于钩子**: 与React的函数组件模型完美契合
- **不需要Provider**: 减少了样板代码
- **支持中间件**: 可扩展性强，支持持久化、日志等功能
- **TypeScript友好**: 提供良好的类型推断
- **性能优化**: 内置的选择性更新机制，减少不必要的重渲染

### 2.3 UI组件库: Shadcn UI + Tailwind CSS

选择 Shadcn UI + Tailwind CSS 的理由:

- **高度可定制**: Shadcn UI提供可复制的组件代码，而非黑盒组件
- **无运行时依赖**: 组件直接集成到项目代码中，便于定制
- **原子化CSS**: Tailwind的原子类方法提高开发效率
- **响应式设计**: Tailwind内置的响应式工具简化移动优先设计
- **主题系统**: 通过CSS变量和Tailwind配置实现强大的主题系统
- **暗模式支持**: 内置暗模式切换功能

### 2.4 表单处理: React Hook Form + Zod

选择 React Hook Form + Zod 的理由:

- **性能优化**: 非受控组件模式减少重渲染
- **验证集成**: 与Zod无缝集成，提供类型安全的表单验证
- **错误处理**: 强大的错误处理和展示机制
- **TypeScript支持**: 自动类型推断减少类型定义工作
- **轻量级**: 最小化包体积，优化加载性能

### 2.5 HTTP客户端: Axios + React Query

选择 Axios + React Query 的理由:

- **请求缓存**: React Query提供智能缓存，减少重复请求
- **数据同步**: 自动后台数据刷新和乐观更新
- **加载和错误状态**: 统一处理请求状态
- **请求拦截**: Axios拦截器便于处理认证和错误
- **TypeScript支持**: 类型安全的API调用
- **并发控制**: 请求去重和重试机制

### 2.6 图表库: Chart.js + React-Chartjs-2

选择 Chart.js + React-Chartjs-2 的理由:

- **轻量级**: 相比其他图表库体积小
- **响应式**: 自适应容器大小
- **动画效果**: 流畅的数据可视化动画
- **交互性**: 支持悬停、点击等交互事件
- **定制性**: 高度可定制的外观和行为
- **React集成**: React-Chartjs-2提供React友好的API

## 3. 架构设计

### 3.1 项目结构

```
client/
├── public/                # 静态资源
│   ├── fonts/            # 字体文件
│   ├── images/           # 图片资源
│   └── locales/          # 国际化文本
│
├── src/
│   ├── app/              # Next.js App Router
│   │   ├── (auth)/       # 认证相关页面
│   │   ├── (dashboard)/  # 已认证用户页面
│   │   ├── api/          # API路由
│   │   └── layout.tsx    # 根布局
│   │
│   ├── components/       # 组件
│   │   ├── ui/           # 基础UI组件
│   │   ├── auth/         # 认证相关组件
│   │   ├── dashboard/    # 仪表盘组件
│   │   ├── transactions/ # 交易相关组件
│   │   ├── categories/   # 分类相关组件
│   │   ├── budgets/      # 预算相关组件
│   │   ├── statistics/   # 统计分析组件
│   │   ├── account-books/# 账本相关组件
│   │   ├── families/     # 家庭账本组件
│   │   ├── settings/     # 设置相关组件
│   │   └── shared/       # 共享组件
│   │
│   ├── hooks/            # 自定义钩子
│   │   ├── use-auth.ts   # 认证钩子
│   │   ├── use-toast.ts  # 通知钩子
│   │   └── use-theme.ts  # 主题钩子
│   │
│   ├── lib/              # 工具库
│   │   ├── api.ts        # API客户端
│   │   ├── utils.ts      # 工具函数
│   │   └── validators.ts # 验证函数
│   │
│   ├── store/            # 状态管理
│   │   ├── auth-store.ts # 认证状态
│   │   ├── theme-store.ts# 主题状态
│   │   └── ui-store.ts   # UI状态
│   │
│   ├── styles/           # 样式文件
│   │   ├── globals.css   # 全局样式
│   │   └── themes.css    # 主题样式
│   │
│   └── types/            # 类型定义
│       ├── api.ts        # API类型
│       ├── models.ts     # 数据模型类型
│       ├── common.ts     # 通用类型
│       └── theme.ts      # 主题类型定义
│
├── .env.local            # 本地环境变量
├── .env.production       # 生产环境变量
├── next.config.js        # Next.js配置
├── tailwind.config.js    # Tailwind配置
└── tsconfig.json         # TypeScript配置
```

### 3.2 状态管理架构

采用分层状态管理策略:

1. **本地组件状态**: 使用React的useState和useReducer管理组件内部状态
2. **共享UI状态**: 使用Zustand存储全局UI状态(侧边栏状态、模态框状态等)
3. **主题状态**: 使用专门的Zustand store管理主题选择和自定义主题
4. **业务领域状态**: 使用Zustand按功能模块划分状态库
5. **服务器状态**: 使用React Query管理API数据，处理缓存和同步

### 3.3 数据流设计

1. **API客户端**: 使用Axios创建基础API客户端，配置拦截器处理认证和错误
2. **数据获取**: 使用React Query的useQuery钩子获取和缓存数据
3. **数据修改**: 使用React Query的useMutation钩子处理数据修改
4. **错误处理**: 全局错误处理中间件，统一展示错误通知
5. **认证**: 请求拦截器自动添加认证令牌，响应拦截器处理401错误
6. **缓存策略**: 根据数据类型设置不同的缓存时间和失效策略

### 3.4 响应式设计方案

采用移动优先的响应式设计:

1. **断点设计**:
   - xs: 0-639px (手机)
   - sm: 640px-767px (大手机)
   - md: 768px-1023px (平板)
   - lg: 1024px-1279px (小笔记本)
   - xl: 1280px+ (桌面)

2. **布局策略**:
   - 移动端: 单列布局，底部导航栏
   - 平板/桌面: 侧边栏导航 + 主内容区

3. **组件适应**:
   - 使用Tailwind的响应式前缀(sm:, md:, lg:)
   - 关键组件设计多种布局变体
   - 使用CSS Grid和Flexbox创建灵活布局

## 4. 主题系统

### 4.1 主题架构

主题系统基于CSS变量和Tailwind CSS构建:

- **基础变量**: 所有主题共享的基础CSS变量
- **主题变体**: 基于基础变量的不同主题实现
- **主题切换**: 通过切换CSS变量实现无刷新主题切换
- **主题存储**: 用户主题偏好保存在本地存储中
- **主题继承**: 支持主题间的继承和覆盖

### 4.2 内置主题

应用提供以下内置主题:

1. **默认主题 (Default)**: 蓝色基调的明亮主题
2. **暗色主题 (Dark)**: 深色背景的暗色主题
3. **蓝色主题 (Blue)**: 深蓝色调的主题
4. **绿色主题 (Green)**: 自然绿色调的主题
5. **紫色主题 (Purple)**: 优雅紫色调的主题

## 5. 页面实现计划

### 5.1 认证页面

- **登录页**: 邮箱密码登录，记住我功能，忘记密码链接
- **注册页**: 多步注册流程，密码强度指示器，邮箱验证
- **密码找回页**: 邮箱验证，重置链接，密码重置表单

### 5.2 核心页面

- **仪表盘**: 财务概览，预算进度，最近交易
- **交易管理**: 交易列表，添加/编辑交易，交易详情
- **分类管理**: 分类列表，添加/编辑分类
- **预算管理**: 预算列表，添加/编辑预算，预算详情
- **统计分析**: 消费趋势，分类占比，预算执行分析
- **账本管理**: 账本列表，添加/编辑账本，家庭账本
- **设置页面**: 个人设置，应用设置，主题设置

## 6. 开发路线图

前端开发将按照以下路线图进行:

1. **基础架构搭建** (2周)
   - 项目初始化与配置
   - 核心组件库开发
   - 认证系统实现
   - 全局布局与导航

2. **核心功能开发** (4周)
   - 交易管理模块
   - 分类管理模块
   - 预算管理模块
   - 统计分析模块

3. **高级功能开发** (3周)
   - 账本管理
   - 家庭账本功能
   - 设置与个性化

4. **优化与测试** (2周)
   - 性能优化
   - 兼容性测试
   - 用户体验优化
   - 自动化测试

5. **部署与发布** (1周)
   - 生产环境配置
   - CI/CD流程设置
   - 应用发布
