# 托管成员预算修复指南

## 问题描述
托管成员在跨月时没有自动生成新月份的预算。

## 解决方案
使用提供的修复脚本直接从数据库层面解决问题。

## 使用步骤

### 1. 复制脚本到容器
```bash
docker cp fix-custodial-budgets.js zhiweijz-backend:/tmp/
```

### 2. 预览模式（推荐先执行）
```bash
docker exec -it zhiweijz-backend node /tmp/fix-custodial-budgets.js --dry-run
```

### 3. 修复模式（实际修改数据）
```bash
docker exec -it zhiweijz-backend node /tmp/fix-custodial-budgets.js
```

### 4. 清理临时文件（可选）
```bash
docker exec -it zhiweijz-backend rm /tmp/fix-custodial-budgets.js
```

## 脚本功能
- 查找所有托管成员（`is_custodial = true`）
- 检查是否已有当前月份预算
- 基于最新预算创建当前月份预算
- 正确处理预算结转逻辑
- 自动验证修复结果

## 安全特性
- 支持预览模式，可先查看会创建什么
- 自动检查避免重复创建
- 详细的执行日志
- 执行后自动统计验证

## 输出示例
```
=== 托管成员预算修复脚本 ===
模式: 预览模式（不会修改数据）

📡 测试数据库连接...
✅ 数据库连接正常

当前月份: 2024-12-01 ~ 2024-12-31

找到 2 个托管成员

托管成员: 小明
  账本: 张家账本
    📋 基于预算: 小明零花钱 (2024-11-30)
    结转: 预算100 + 上次0 - 支出50 = 50
    [预览] 小明零花钱 - 金额:100 结转:50

=== 修复完成 ===
处理数量: 2
预览创建: 1
跳过数量: 1

=== 验证结果 ===
托管成员总数: 2
有当前月份预算: 2
缺失预算: 0
🎉 所有托管成员都有当前月份预算！
```

## 注意事项
1. 建议先用预览模式查看会创建什么
2. 只有存在历史预算的托管成员才能创建新预算
3. 脚本会自动处理预算结转逻辑
4. 执行完成后可以删除临时文件
