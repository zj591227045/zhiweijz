# Scripts ç›®å½•ç»“æ„

æœ¬ç›®å½•åŒ…å«æ™ºæ…§è®°è´¦é¡¹ç›®çš„å„ç§è„šæœ¬ï¼ŒæŒ‰ç”¨é€”åˆ†ç±»ç»„ç»‡ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ deployment/         # éƒ¨ç½²ç›¸å…³è„šæœ¬
â”œâ”€â”€ testing/           # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ development/       # å¼€å‘ç›¸å…³è„šæœ¬
â”œâ”€â”€ docker/           # Dockerç›¸å…³è„šæœ¬
â”œâ”€â”€ database/         # æ•°æ®åº“ç›¸å…³è„šæœ¬
â”œâ”€â”€ monitoring/       # ç›‘æ§ç›¸å…³è„šæœ¬
â”œâ”€â”€ utilities/        # å·¥å…·è„šæœ¬
â””â”€â”€ README.md         # æœ¬æ–‡ä»¶
```

## ğŸš€ deployment/ - éƒ¨ç½²ç›¸å…³è„šæœ¬

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `release-version.sh` | ç‰ˆæœ¬å‘å¸ƒè„šæœ¬ | `./deployment/release-version.sh --minor` |
| `start-backend.sh` | å¯åŠ¨åç«¯æœåŠ¡ | `./deployment/start-backend.sh` |
| `start-dev-frontend.sh` | å¯åŠ¨å¼€å‘å‰ç«¯ | `./deployment/start-dev-frontend.sh` |

## ğŸ§ª testing/ - æµ‹è¯•è„šæœ¬

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `demo-tests.js` | æ¼”ç¤ºæµ‹è¯• | `node testing/demo-tests.js` |
| `run-full-tests.js` | è¿è¡Œå®Œæ•´æµ‹è¯• | `node testing/run-full-tests.js` |
| `test-android-setup.js` | Androidè®¾ç½®æµ‹è¯• | `node testing/test-android-setup.js` |
| `test-backend-api.js` | åç«¯APIæµ‹è¯• | `node testing/test-backend-api.js` |
| `test-backend-build.sh` | åç«¯æ„å»ºæµ‹è¯• | `./testing/test-backend-build.sh` |
| `test-e2e.js` | ç«¯åˆ°ç«¯æµ‹è¯• | `node testing/test-e2e.js` |
| `test-environment-guide.js` | ç¯å¢ƒæµ‹è¯•æŒ‡å— | `node testing/test-environment-guide.js` |
| `test-frontend.js` | å‰ç«¯æµ‹è¯• | `node testing/test-frontend.js` |
| `test-health-check.js` | å¥åº·æ£€æŸ¥æµ‹è¯• | `node testing/test-health-check.js` |
| `test-regression.js` | å›å½’æµ‹è¯• | `node testing/test-regression.js` |
| `test-config.json` | æµ‹è¯•é…ç½®æ–‡ä»¶ | é…ç½®æ–‡ä»¶ |
| `regression-config.json` | å›å½’æµ‹è¯•é…ç½® | é…ç½®æ–‡ä»¶ |

## ğŸ› ï¸ development/ - å¼€å‘ç›¸å…³è„šæœ¬

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `check-env.sh` | æ£€æŸ¥å¼€å‘ç¯å¢ƒ | `./development/check-env.sh` |

## ğŸ³ docker/ - Dockerç›¸å…³è„šæœ¬

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `fix-docker-mirrors.sh` | ä¿®å¤Dockeré•œåƒæº | `./docker/fix-docker-mirrors.sh` |
| `setup-docker-mirrors.sh` | è®¾ç½®Dockeré•œåƒæº | `./docker/setup-docker-mirrors.sh` |
| `test-mirrors.sh` | æµ‹è¯•é•œåƒæº | `./docker/test-mirrors.sh` |

## ğŸ—„ï¸ database/ - æ•°æ®åº“ç›¸å…³è„šæœ¬

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `db_backup/` | æ•°æ®åº“å¤‡ä»½å·¥å…·é›† | è§db_backup/README.md |

## ğŸ“Š monitoring/ - ç›‘æ§ç›¸å…³è„šæœ¬

*é¢„ç•™ç›®å½•ï¼Œç”¨äºå°†æ¥çš„ç›‘æ§è„šæœ¬*

## ğŸ”§ utilities/ - å·¥å…·è„šæœ¬

| è„šæœ¬ | ç”¨é€” | ä½¿ç”¨æ–¹æ³• |
|------|------|----------|
| `analyze-server-scripts.js` | åˆ†æserverç›®å½•è„šæœ¬ | `node utilities/analyze-server-scripts.js` |

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### éƒ¨ç½²ç›¸å…³

```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x ./scripts/start-backend.sh

# è¿è¡Œè„šæœ¬
./scripts/start-backend.sh
```

æ­¤è„šæœ¬å°†ï¼š
- è®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ä»¥å¯ç”¨è¯¦ç»†æ—¥å¿—
- æ£€æŸ¥ä¾èµ–æ˜¯å¦å·²å®‰è£…
- ä½¿ç”¨nodemonå¯åŠ¨åç«¯æœåŠ¡ï¼Œå®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–
- æ˜¾ç¤ºå½©è‰²æ—¥å¿—è¾“å‡º

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x ./scripts/start-frontend.sh

# è¿è¡Œè„šæœ¬
./scripts/start-frontend.sh
```

æ­¤è„šæœ¬å°†ï¼š
- è®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ä»¥å¯ç”¨è¯¦ç»†æ—¥å¿—
- æ£€æŸ¥ä¾èµ–æ˜¯å¦å·²å®‰è£…
- ä½¿ç”¨Next.jsçš„å¼€å‘æœåŠ¡å™¨å¯åŠ¨å‰ç«¯ï¼Œä½¿ç”¨turbopackåŠ é€Ÿæ„å»º
- é€šè¿‡ç¯å¢ƒå˜é‡å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼Œæ˜¾ç¤ºå½©è‰²æ—¥å¿—è¾“å‡º

### 3. åŒæ—¶å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x ./scripts/start-all.sh

# è¿è¡Œè„šæœ¬
./scripts/start-all.sh
```

æ­¤è„šæœ¬å°†ï¼š
- å¦‚æœå®‰è£…äº†tmuxï¼Œä½¿ç”¨tmuxåˆ›å»ºå¤šä¸ªçª—å£åˆ†åˆ«è¿è¡Œåç«¯å’Œå‰ç«¯æœåŠ¡
- å¦‚æœæœªå®‰è£…tmuxï¼Œå°†åœ¨åå°å¯åŠ¨æœåŠ¡å¹¶å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶

## æ—¥å¿—çº§åˆ«

è¿™äº›è„šæœ¬è®¾ç½®äº†ä»¥ä¸‹ç¯å¢ƒå˜é‡ä»¥å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

### åç«¯
- `DEBUG=express:*,prisma:*,app:*`ï¼šå¯ç”¨Expressã€Prismaå’Œåº”ç”¨ç¨‹åºçš„è°ƒè¯•æ—¥å¿—
- `NODE_ENV=development`ï¼šè®¾ç½®ä¸ºå¼€å‘ç¯å¢ƒ
- `LOG_LEVEL=debug`ï¼šè®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebug

### å‰ç«¯
- `NODE_ENV=development`ï¼šè®¾ç½®ä¸ºå¼€å‘ç¯å¢ƒ
- `NEXT_TELEMETRY_DISABLED=1`ï¼šç¦ç”¨Next.jsé¥æµ‹
- `DEBUG=next:*,react:*,app:*`ï¼šå¯ç”¨Next.jsã€Reactå’Œåº”ç”¨ç¨‹åºçš„è°ƒè¯•æ—¥å¿—

## è‡ªå®šä¹‰

å¦‚éœ€è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«æˆ–å…¶ä»–è®¾ç½®ï¼Œå¯ä»¥ç¼–è¾‘è„šæœ¬æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ã€‚

---

# å®Œæ•´åŠŸèƒ½æµ‹è¯•è„šæœ¬

è¿™å¥—æµ‹è¯•è„šæœ¬æä¾›äº†å®Œæ•´çš„å‰ç«¯å’Œåç«¯åŠŸèƒ½æµ‹è¯•ï¼Œç¡®ä¿åœ¨æ›´æ–°ä»£ç æ—¶ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½ã€‚

## ğŸ“‹ æµ‹è¯•è„šæœ¬æ¦‚è§ˆ

### ğŸ¯ ä¸»è¦æµ‹è¯•è„šæœ¬

| è„šæœ¬ | å‘½ä»¤ | æè¿° | è€—æ—¶ |
|------|------|------|------|
| **å®Œæ•´æµ‹è¯•** | `npm run test:full` | è¿è¡Œæ‰€æœ‰æµ‹è¯•å¥—ä»¶ | 15-30åˆ†é’Ÿ |
| **åç«¯APIæµ‹è¯•** | `npm run test:backend-api` | æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹ | 3-5åˆ†é’Ÿ |
| **å‰ç«¯åŠŸèƒ½æµ‹è¯•** | `npm run test:frontend` | æµ‹è¯•å‰ç«¯é¡µé¢å’Œç»„ä»¶ | 5-10åˆ†é’Ÿ |
| **ç«¯åˆ°ç«¯æµ‹è¯•** | `npm run test:e2e` | æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹ | 10-15åˆ†é’Ÿ |
| **å›å½’æµ‹è¯•** | `npm run test:regression` | å®Œæ•´å›å½’æµ‹è¯•å¥—ä»¶ | 20-40åˆ†é’Ÿ |
| **å¥åº·æ£€æŸ¥** | `npm run test:health` | å¿«é€Ÿç³»ç»Ÿå¥åº·æ£€æŸ¥ | 1-2åˆ†é’Ÿ |

### ğŸ”§ æµ‹è¯•é…ç½®æ–‡ä»¶

- `test-config.json` - åŸºç¡€æµ‹è¯•é…ç½®
- `regression-config.json` - å›å½’æµ‹è¯•é…ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š

```bash
# å®‰è£…æ ¹ç›®å½•ä¾èµ–
npm install

# å®‰è£…åç«¯ä¾èµ–
cd server && npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd apps/web && npm install
```

### 2. æ•°æ®åº“å‡†å¤‡

ç¡®ä¿æ•°æ®åº“æ­£å¸¸è¿è¡Œå¹¶å·²æ‰§è¡Œè¿ç§»ï¼š

```bash
cd server
npx prisma migrate dev
npx prisma generate
```

### 3. è¿è¡Œæµ‹è¯•

#### å¿«é€Ÿå¥åº·æ£€æŸ¥
```bash
npm run test:health
```

#### å®Œæ•´åŠŸèƒ½æµ‹è¯•
```bash
npm run test:full
```

#### å•ç‹¬è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# åªæµ‹è¯•åç«¯API
npm run test:backend-api

# åªæµ‹è¯•å‰ç«¯
npm run test:frontend

# åªæµ‹è¯•ç«¯åˆ°ç«¯æµç¨‹
npm run test:e2e
```

## ğŸ“Š æµ‹è¯•è¯¦æƒ…

### ğŸ”™ åç«¯APIæµ‹è¯• (`test-backend-api.js`)

**æµ‹è¯•å†…å®¹ï¼š**
- âœ… ç”¨æˆ·è®¤è¯ï¼ˆæ³¨å†Œã€ç™»å½•ã€è®¤è¯æ£€æŸ¥ï¼‰
- âœ… è´¦æœ¬ç®¡ç†ï¼ˆåˆ›å»ºã€è·å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- âœ… åˆ†ç±»ç®¡ç†ï¼ˆè·å–ã€åˆ›å»ºè‡ªå®šä¹‰åˆ†ç±»ï¼‰
- âœ… äº¤æ˜“ç®¡ç†ï¼ˆåˆ›å»ºã€è·å–ã€æ›´æ–°äº¤æ˜“è®°å½•ï¼‰
- âœ… é¢„ç®—ç®¡ç†ï¼ˆåˆ›å»ºã€è·å–é¢„ç®—ï¼‰
- âœ… ç»Ÿè®¡æ•°æ®ï¼ˆæ”¯å‡ºã€æ”¶å…¥ã€é¢„ç®—ç»Ÿè®¡ï¼‰

**ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨åˆ›å»ºå’Œæ¸…ç†æµ‹è¯•æ•°æ®
- å®Œæ•´çš„APIç«¯ç‚¹è¦†ç›–
- é”™è¯¯å¤„ç†éªŒè¯
- å“åº”æ•°æ®æ ¼å¼éªŒè¯

### ğŸ¨ å‰ç«¯åŠŸèƒ½æµ‹è¯• (`test-frontend.js`)

**æµ‹è¯•å†…å®¹ï¼š**
- âœ… é¡µé¢æ¸²æŸ“æµ‹è¯•ï¼ˆæ‰€æœ‰ä¸»è¦é¡µé¢ï¼‰
- âœ… TypeScriptç¼–è¯‘æ£€æŸ¥
- âœ… ä»£ç è§„èŒƒæ£€æŸ¥ï¼ˆESLintï¼‰
- âœ… æ„å»ºè¿‡ç¨‹æµ‹è¯•
- âœ… ä¾èµ–å®Œæ•´æ€§æ£€æŸ¥
- âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥
- âœ… APIé›†æˆæµ‹è¯•

**ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨å¯åŠ¨å’Œåœæ­¢å‰ç«¯æœåŠ¡
- é¡µé¢å¯è®¿é—®æ€§éªŒè¯
- æ„å»ºäº§ç‰©æ£€æŸ¥
- å¼€å‘ç¯å¢ƒéªŒè¯

### ğŸ”„ ç«¯åˆ°ç«¯æµ‹è¯• (`test-e2e.js`)

**æµ‹è¯•å†…å®¹ï¼š**
- âœ… å®Œæ•´ç”¨æˆ·æ³¨å†Œæµç¨‹
- âœ… ç”¨æˆ·ç™»å½•æµç¨‹
- âœ… ä»ªè¡¨ç›˜è®¿é—®å’Œæ•°æ®æ˜¾ç¤º
- âœ… è´¦æœ¬ç®¡ç†å®Œæ•´æµç¨‹
- âœ… äº¤æ˜“è®°å½•ç®¡ç†æµç¨‹
- âœ… é¢„ç®—ç®¡ç†æµç¨‹
- âœ… ç»Ÿè®¡é¡µé¢åŠŸèƒ½

**ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨å¯åŠ¨å‰åç«¯æœåŠ¡
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ
- å‰åç«¯åä½œéªŒè¯
- æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

### ğŸ” å›å½’æµ‹è¯• (`test-regression.js`)

**æµ‹è¯•å†…å®¹ï¼š**
- âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… APIåŠŸèƒ½å®Œæ•´æ€§
- âœ… å‰ç«¯æ„å»ºå’ŒåŠŸèƒ½
- âœ… ç«¯åˆ°ç«¯ç”¨æˆ·æµç¨‹
- âœ… æ€§èƒ½å›å½’æ£€æµ‹
- âœ… åŸºçº¿æ•°æ®æ¯”è¾ƒ

**ç‰¹ç‚¹ï¼š**
- å…¨é¢çš„åŠŸèƒ½è¦†ç›–
- æ€§èƒ½å›å½’æ£€æµ‹
- åŸºçº¿æ•°æ®ç®¡ç†
- è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š

### âš¡ å¥åº·æ£€æŸ¥ (`test-health-check.js`)

**æ£€æŸ¥å†…å®¹ï¼š**
- âœ… åç«¯APIè¿é€šæ€§
- âœ… æ•°æ®åº“è¿æ¥çŠ¶æ€
- âœ… å‰ç«¯æœåŠ¡çŠ¶æ€
- âœ… ç£ç›˜ç©ºé—´ä½¿ç”¨
- âœ… å†…å­˜ä½¿ç”¨æƒ…å†µ
- âœ… ä¾èµ–å®Œæ•´æ€§
- âœ… ç¯å¢ƒå˜é‡é…ç½®
- âœ… ç«¯å£å¯ç”¨æ€§

**ç‰¹ç‚¹ï¼š**
- å¿«é€Ÿç³»ç»ŸçŠ¶æ€æ£€æŸ¥
- èµ„æºä½¿ç”¨ç›‘æ§
- é—®é¢˜æ—©æœŸå‘ç°
- è¯¦ç»†çš„å¥åº·æŠ¥å‘Š

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

æ‰€æœ‰æµ‹è¯•éƒ½ä¼šç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼Œä¿å­˜åœ¨ `test-reports/` ç›®å½•ä¸­ï¼š

- `test-report-{timestamp}.json` - å®Œæ•´æµ‹è¯•æŠ¥å‘Š
- `regression-report-{timestamp}.json` - å›å½’æµ‹è¯•æŠ¥å‘Š
- `health-check-{timestamp}.json` - å¥åº·æ£€æŸ¥æŠ¥å‘Š
- `baseline.json` - åŸºçº¿æ•°æ®ï¼ˆç”¨äºå›å½’æ¯”è¾ƒï¼‰

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£ä½¿ç”¨æƒ…å†µ
   lsof -i :3000
   lsof -i :3003
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   cd server
   npx prisma db pull
   ```

3. **ä¾èµ–ç¼ºå¤±**
   ```bash
   # é‡æ–°å®‰è£…ä¾èµ–
   npm install
   cd server && npm install
   cd apps/web && npm install
   ```

4. **æµ‹è¯•è¶…æ—¶**
   - å¢åŠ é…ç½®æ–‡ä»¶ä¸­çš„ `timeout` å€¼
   - æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### è°ƒè¯•æ¨¡å¼

è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
export DEBUG=true
export VERBOSE=true
npm run test:full
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. å®šæœŸè¿è¡Œæµ‹è¯•

å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µè¿è¡Œæµ‹è¯•ï¼š

- âœ… æ¯æ¬¡ä»£ç æäº¤å‰
- âœ… åˆå¹¶åˆ†æ”¯å‰
- âœ… å‘å¸ƒæ–°ç‰ˆæœ¬å‰
- âœ… å®šæœŸå¥åº·æ£€æŸ¥ï¼ˆæ¯æ—¥/æ¯å‘¨ï¼‰

### 2. æµ‹è¯•ä¼˜å…ˆçº§

æ ¹æ®é‡è¦æ€§é€‰æ‹©æµ‹è¯•ï¼š

1. **å…³é”®æ›´æ–°** â†’ è¿è¡Œå®Œæ•´å›å½’æµ‹è¯•
2. **åŠŸèƒ½å¼€å‘** â†’ è¿è¡Œç›¸å…³åŠŸèƒ½æµ‹è¯•
3. **Bugä¿®å¤** â†’ è¿è¡Œç›¸å…³æµ‹è¯• + å›å½’æµ‹è¯•
4. **æ—¥å¸¸æ£€æŸ¥** â†’ è¿è¡Œå¥åº·æ£€æŸ¥

### 3. æŒç»­é›†æˆ

å¯ä»¥å°†è¿™äº›è„šæœ¬é›†æˆåˆ°CI/CDæµæ°´çº¿ä¸­ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Full Tests
  run: npm run test:full

- name: Run Health Check
  run: npm run test:health
```

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### å¼€å‘é˜¶æ®µ
```bash
# å¿«é€ŸéªŒè¯
npm run test:health

# åŠŸèƒ½éªŒè¯
npm run test:backend-api
npm run test:frontend
```

### å‘å¸ƒå‰
```bash
# å®Œæ•´éªŒè¯
npm run test:regression
```

### ç”Ÿäº§ç›‘æ§
```bash
# å®šæœŸæ£€æŸ¥
npm run test:health
```

è¿™å¥—æµ‹è¯•è„šæœ¬ç¡®ä¿äº†é¡¹ç›®çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œå¸®åŠ©æ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ã€‚
