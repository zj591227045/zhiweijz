# é¢„ç®—ä¿®å¤è„šæœ¬ - å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„æ–¹å¼ï¼ˆäº¤äº’å¼èœå•ï¼‰
```bash
cd docker/scripts/fix_budget
./run_budget_fix.sh
```

ç„¶åæ ¹æ®èœå•é€‰æ‹©éœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚

---

## ğŸ“‹ å‘½ä»¤é€ŸæŸ¥è¡¨

### äº¤äº’å¼æ¨¡å¼
```bash
# ä½¿ç”¨å½“å‰æœˆä»½
./run_budget_fix.sh

# æŒ‡å®šå¹´æœˆ
./run_budget_fix.sh 2025 9
```

### å‘½ä»¤è¡Œæ¨¡å¼

| åŠŸèƒ½ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| åˆ›å»ºé¢„ç®— | `./run_budget_fix.sh -c` | åˆ›å»ºå½“å‰æœˆä»½ç¼ºå¤±çš„é¢„ç®— |
| åˆ›å»ºé¢„ç®—ï¼ˆæŒ‡å®šæœˆä»½ï¼‰ | `./run_budget_fix.sh -c 2025 9` | åˆ›å»º2025å¹´9æœˆç¼ºå¤±çš„é¢„ç®— |
| ä¿®å¤å†å² | `./run_budget_fix.sh -h` | ä¿®å¤æ‰€æœ‰ç»“è½¬å†å²è®°å½• |
| ä¿®å¤ç»“è½¬ | `./run_budget_fix.sh -r` | ä¿®å¤æ‰€æœ‰é¢„ç®—çš„ç»“è½¬é‡‘é¢ |
| å…¨éƒ¨æ‰§è¡Œ | `./run_budget_fix.sh -a` | æ‰§è¡Œæ‰€æœ‰ä¿®å¤æ“ä½œï¼ˆå½“å‰æœˆä»½ï¼‰ |
| å…¨éƒ¨æ‰§è¡Œï¼ˆæŒ‡å®šæœˆä»½ï¼‰ | `./run_budget_fix.sh -a 2025 10` | æ‰§è¡Œæ‰€æœ‰ä¿®å¤æ“ä½œï¼ˆ2025å¹´10æœˆï¼‰ |
| å¸®åŠ© | `./run_budget_fix.sh --help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

---

## ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ¯æœˆåˆåˆ›å»ºæ–°é¢„ç®—
```bash
# æ–¹æ³•1ï¼šäº¤äº’å¼ï¼ˆæ¨èï¼‰
./run_budget_fix.sh
# é€‰æ‹©é€‰é¡¹ 1

# æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ
./run_budget_fix.sh -c
```

### åœºæ™¯2ï¼šç”¨æˆ·åé¦ˆé¢„ç®—é‡‘é¢ä¸å¯¹
```bash
# æ–¹æ³•1ï¼šäº¤äº’å¼ï¼ˆæ¨èï¼‰
./run_budget_fix.sh
# é€‰æ‹©é€‰é¡¹ 3

# æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ
./run_budget_fix.sh -r
```

### åœºæ™¯3ï¼šä¿®å¤å†å²æ•°æ®
```bash
# æ–¹æ³•1ï¼šäº¤äº’å¼ï¼ˆæ¨èï¼‰
./run_budget_fix.sh
# é€‰æ‹©é€‰é¡¹ 2

# æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ
./run_budget_fix.sh -h
```

### åœºæ™¯4ï¼šå…¨é¢ä¿®å¤ï¼ˆæ–°ç³»ç»Ÿéƒ¨ç½²åï¼‰
```bash
# æ–¹æ³•1ï¼šäº¤äº’å¼ï¼ˆæ¨èï¼‰
./run_budget_fix.sh
# é€‰æ‹©é€‰é¡¹ 4

# æ–¹æ³•2ï¼šå‘½ä»¤è¡Œ
./run_budget_fix.sh -a
```

---

## ğŸ”§ å‘½ä»¤è¡Œé€‰é¡¹è¯¦è§£

### `-c, --create` - åˆ›å»ºç¼ºå¤±çš„é¢„ç®—
**ä½œç”¨ï¼š** ä¸ºæŒ‡å®šæœˆä»½åˆ›å»ºç¼ºå¤±çš„ä¸ªäººé¢„ç®—

**é€‚ç”¨åœºæ™¯ï¼š**
- æ¯æœˆåˆåˆ›å»ºæ–°æœˆä»½é¢„ç®—
- è¡¥å……å†å²æœˆä»½ç¼ºå¤±çš„é¢„ç®—
- æ–°ç”¨æˆ·åŠ å…¥ååˆ›å»ºé¢„ç®—

**ç¤ºä¾‹ï¼š**
```bash
# åˆ›å»ºå½“å‰æœˆä»½é¢„ç®—
./run_budget_fix.sh -c

# åˆ›å»º2025å¹´9æœˆé¢„ç®—
./run_budget_fix.sh -c 2025 9
```

### `-h, --history` - ä¿®å¤ç»“è½¬å†å²
**ä½œç”¨ï¼š** ä¸ºæ‰€æœ‰å·²è¿‡æœŸä¸”å¯ç”¨ç»“è½¬çš„é¢„ç®—åˆ›å»ºç¼ºå¤±çš„ç»“è½¬å†å²è®°å½•

**é€‚ç”¨åœºæ™¯ï¼š**
- å†å²æ•°æ®è¿ç§»å
- ç»“è½¬å†å²è®°å½•ä¸¢å¤±
- å®šæœŸæ•°æ®å®Œæ•´æ€§æ£€æŸ¥

**ç¤ºä¾‹ï¼š**
```bash
./run_budget_fix.sh -h
```

### `-r, --rollover` - ä¿®å¤ç»“è½¬é‡‘é¢
**ä½œç”¨ï¼š** å¯¹æ¯”å¹¶ä¿®å¤æ‰€æœ‰å·²åˆ›å»ºé¢„ç®—çš„ç»“è½¬é‡‘é¢

**é€‚ç”¨åœºæ™¯ï¼š**
- ç”¨æˆ·ä¿®æ”¹æˆ–åˆ é™¤äº†å†å²äº¤æ˜“
- ä¸ŠæœŸé¢„ç®—ç»“è½¬é‡‘é¢è¢«ä¿®æ­£
- å®šæœŸæ•°æ®å‡†ç¡®æ€§æ£€æŸ¥

**ç¤ºä¾‹ï¼š**
```bash
./run_budget_fix.sh -r
```

### `-a, --all` - æ‰§è¡Œæ‰€æœ‰æ“ä½œ
**ä½œç”¨ï¼š** ä¾æ¬¡æ‰§è¡Œåˆ›å»ºé¢„ç®—ã€ä¿®å¤å†å²ã€ä¿®å¤ç»“è½¬é‡‘é¢

**é€‚ç”¨åœºæ™¯ï¼š**
- æ–°ç³»ç»Ÿéƒ¨ç½²åçš„åˆå§‹åŒ–
- å…¨é¢çš„æ•°æ®ä¿®å¤
- å®šæœŸç»´æŠ¤

**ç¤ºä¾‹ï¼š**
```bash
# å½“å‰æœˆä»½
./run_budget_fix.sh -a

# æŒ‡å®šæœˆä»½
./run_budget_fix.sh -a 2025 10
```

---

## ğŸ“Š äº¤äº’å¼èœå•è¯´æ˜

å¯åŠ¨äº¤äº’å¼èœå•åï¼Œä¼šçœ‹åˆ°ä»¥ä¸‹é€‰é¡¹ï¼š

```
==========================================
       é¢„ç®—ä¿®å¤è„šæœ¬ - äº¤äº’å¼èœå•
==========================================

è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œ:

  1) åˆ›å»ºç¼ºå¤±çš„YYYYå¹´MMæœˆä¸ªäººé¢„ç®—
  2) ä¿®å¤é¢„ç®—ç»“è½¬å†å²è®°å½•
  3) ä¿®å¤å·²åˆ›å»ºé¢„ç®—çš„ç»“è½¬é‡‘é¢
  4) æ‰§è¡Œæ‰€æœ‰æ“ä½œ (1+2+3)
  0) é€€å‡º

==========================================
```

**é€‰é¡¹è¯´æ˜ï¼š**
- **é€‰é¡¹1**ï¼šä»…åˆ›å»ºæŒ‡å®šæœˆä»½çš„ç¼ºå¤±é¢„ç®—
- **é€‰é¡¹2**ï¼šä»…ä¿®å¤æ‰€æœ‰å†å²é¢„ç®—çš„ç»“è½¬è®°å½•
- **é€‰é¡¹3**ï¼šä»…ä¿®å¤æ‰€æœ‰å·²åˆ›å»ºé¢„ç®—çš„ç»“è½¬é‡‘é¢
- **é€‰é¡¹4**ï¼šä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰ä¸‰ä¸ªæ“ä½œ
- **é€‰é¡¹0**ï¼šé€€å‡ºç¨‹åº

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ‰§è¡Œå‰
1. **å¤‡ä»½æ•°æ®åº“**ï¼ˆé‡è¦ï¼ï¼‰
2. ç¡®è®¤ `docker/.env` é…ç½®æ­£ç¡®
3. ç¡®ä¿æ•°æ®åº“å¯è®¿é—®

### æ‰§è¡Œä¸­
1. ä»”ç»†é˜…è¯»æç¤ºä¿¡æ¯
2. ç¡®è®¤æ“ä½œåå†æ‰§è¡Œ
3. è§‚å¯Ÿæ‰§è¡Œæ—¥å¿—

### æ‰§è¡Œå
1. æ£€æŸ¥æ‰§è¡Œç»“æœ
2. éªŒè¯æ•°æ®æ­£ç¡®æ€§
3. å¦‚æœ‰é—®é¢˜åŠæ—¶å›æ»š

---

## ğŸ” éªŒè¯ç»“æœ

### å¿«é€ŸéªŒè¯æŸ¥è¯¢
```sql
-- æ£€æŸ¥æŒ‡å®šæœˆä»½é¢„ç®—æ•°é‡
SELECT COUNT(*) FROM budgets 
WHERE start_date >= '2025-09-01' 
  AND start_date <= '2025-09-01' 
  AND budget_type = 'PERSONAL';

-- æ£€æŸ¥ç»“è½¬é‡‘é¢æ˜¯å¦æ­£ç¡®
SELECT 
  u.name, 
  b.name, 
  b.amount, 
  b.rollover_amount,
  b.start_date
FROM budgets b
JOIN users u ON b.user_id = u.id
WHERE b.rollover = true
  AND b.budget_type = 'PERSONAL'
ORDER BY u.name, b.start_date;
```

---

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ— æ³•è¿æ¥æ•°æ®åº“
**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `docker/.env` é…ç½®
2. ç¡®è®¤æ•°æ®åº“å®¹å™¨è¿è¡Œä¸­ï¼š`docker ps | grep postgres`
3. æ£€æŸ¥ç«¯å£æ˜ å°„ï¼š`docker port zhiweijz-postgres`

### é—®é¢˜2ï¼šæƒé™ä¸è¶³
**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æœ‰è¯»å†™æƒé™
2. æ£€æŸ¥ `.env` ä¸­çš„ç”¨æˆ·åå’Œå¯†ç 

### é—®é¢˜3ï¼šè„šæœ¬æ‰§è¡Œå¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š**
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
2. ç¡®è®¤SQLè„šæœ¬æ–‡ä»¶å­˜åœ¨
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜4ï¼šæ•°æ®ä¸æ­£ç¡®
**è§£å†³æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨éªŒè¯æŸ¥è¯¢æ£€æŸ¥æ•°æ®
2. å¦‚éœ€å›æ»šï¼Œæ¢å¤æ•°æ®åº“å¤‡ä»½
3. é‡æ–°æ‰§è¡Œè„šæœ¬

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
```bash
./run_budget_fix.sh --help
```

### æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
- å®Œæ•´æ–‡æ¡£ï¼š`README.md`
- ä½¿ç”¨ç¤ºä¾‹ï¼š`USAGE_EXAMPLE.md`
- å¿«é€Ÿå‚è€ƒï¼š`QUICK_REFERENCE.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸç»´æŠ¤
å»ºè®®æ¯æœˆåˆæ‰§è¡Œä¸€æ¬¡å…¨é¢æ£€æŸ¥ï¼š
```bash
./run_budget_fix.sh -a
```

### 2. é—®é¢˜ä¿®å¤
é‡åˆ°ç”¨æˆ·åé¦ˆé—®é¢˜æ—¶ï¼Œå…ˆæ‰§è¡Œç»“è½¬é‡‘é¢ä¿®å¤ï¼š
```bash
./run_budget_fix.sh -r
```

### 3. æ•°æ®è¿ç§»
æ–°ç³»ç»Ÿéƒ¨ç½²æˆ–æ•°æ®è¿ç§»åï¼Œæ‰§è¡Œæ‰€æœ‰æ“ä½œï¼š
```bash
./run_budget_fix.sh -a
```

### 4. æµ‹è¯•ç¯å¢ƒ
åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼š
```bash
# æµ‹è¯•ç¯å¢ƒ
./run_budget_fix.sh -a

# éªŒè¯æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ
```

---

## ğŸ“ æ‰§è¡Œè®°å½•æ¨¡æ¿

å»ºè®®æ¯æ¬¡æ‰§è¡Œåè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š

```
æ‰§è¡Œæ—¥æœŸï¼šYYYY-MM-DD
æ‰§è¡Œäººï¼šXXX
æ‰§è¡Œæ“ä½œï¼š[åˆ›å»ºé¢„ç®—/ä¿®å¤å†å²/ä¿®å¤ç»“è½¬/å…¨éƒ¨]
ç›®æ ‡æœˆä»½ï¼šYYYYå¹´MMæœˆ
æ‰§è¡Œç»“æœï¼š[æˆåŠŸ/å¤±è´¥]
å¤‡æ³¨ï¼šXXX
```

---

**æœ€åæ›´æ–°ï¼š** 2025-10-01  
**ç‰ˆæœ¬ï¼š** v2.2

