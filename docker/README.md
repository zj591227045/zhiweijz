# åªä¸ºè®°è´¦ Docker éƒ¨ç½²åŒ…

## ğŸš€ ä¸€é”®éƒ¨ç½²

è¿™æ˜¯åªä¸ºè®°è´¦åº”ç”¨çš„å®Œæ•´Dockeréƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«æ•°æ®åº“ã€åç«¯ã€å‰ç«¯å’ŒNginxåå‘ä»£ç†çš„ä¸€é”®éƒ¨ç½²é…ç½®ã€‚

### âš¡ å¿«é€Ÿå¼€å§‹

```bash
# 1. è¿›å…¥dockerç›®å½•
cd docker

# 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
cp .env.example .env

# 3. ä¸€é”®å¯åŠ¨
./scripts/start.sh
```

### ğŸŒ è®¿é—®åº”ç”¨

å¯åŠ¨å®Œæˆåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- **å‰ç«¯åº”ç”¨**: http://your-ip:8080
- **APIæ¥å£**: http://your-ip:8080/api
- **æ•°æ®åº“**: your-ip:5432

## ğŸ“ ç›®å½•ç»“æ„

```
docker/
â”œâ”€â”€ README.md                  # æœ¬æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml         # Docker Compose é…ç½®
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ init.sql             # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ nginx.conf           # Nginx é…ç½®
â”‚   â””â”€â”€ nginx.Dockerfile     # Nginx é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ scripts/                  # ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ start.sh             # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ stop.sh              # åœæ­¢è„šæœ¬
â”‚   â”œâ”€â”€ setup-mirrors.sh     # Dockeré•œåƒæºè®¾ç½®è„šæœ¬
â”‚   â”œâ”€â”€ generate-schema.sh   # æ•°æ®åº“Schemaç”Ÿæˆè„šæœ¬
â”‚   â””â”€â”€ reset-database.sh    # æ•°æ®åº“é‡ç½®è„šæœ¬
â””â”€â”€ docs/                     # æ–‡æ¡£
    â”œâ”€â”€ DEPLOYMENT.md        # è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
    â”œâ”€â”€ TROUBLESHOOTING.md   # æ•…éšœæ’é™¤æŒ‡å—
    â””â”€â”€ DATABASE_MANAGEMENT.md # æ•°æ®åº“ç®¡ç†æŒ‡å—
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### å¯åŠ¨æœåŠ¡
```bash
./scripts/start.sh
```

### åœæ­¢æœåŠ¡
```bash
./scripts/stop.sh
```

### æ¸…ç†æ‰€æœ‰æ•°æ®
```bash
./scripts/stop.sh --clean
```

### æŸ¥çœ‹æ—¥å¿—
```bash
docker-compose logs -f
```

### é‡å¯æœåŠ¡
```bash
docker-compose restart
```

## ğŸ”§ æœåŠ¡ç»„ä»¶

| æœåŠ¡ | ç«¯å£ | æè¿° |
|------|------|------|
| Nginx | 80 | åå‘ä»£ç†å’Œé™æ€èµ„æºæœåŠ¡ |
| Frontend | 3000 (å†…éƒ¨) | Next.js å‰ç«¯åº”ç”¨ |
| Backend | 3000 (å†…éƒ¨) | Node.js åç«¯API |
| PostgreSQL | 5432 | æ•°æ®åº“æœåŠ¡ |

## ğŸ“Š ç³»ç»Ÿè¦æ±‚

- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **å†…å­˜**: æœ€å°‘ 2GB
- **ç£ç›˜**: æœ€å°‘ 5GB
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows

## ğŸ”’ é»˜è®¤é…ç½®

### æ•°æ®åº“
- **æ•°æ®åº“å**: zhiweijz
- **ç”¨æˆ·å**: zhiweijz
- **å¯†ç **: zhiweijz123

### å®‰å…¨æé†’
âš ï¸ **ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ä¿®æ”¹é»˜è®¤å¯†ç å’Œå¯†é’¥ï¼**

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```bash
POSTGRES_PASSWORD=your-strong-password
JWT_SECRET=your-jwt-secret-key
```

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :80
   ```

2. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹æ—¥å¿—
   docker-compose logs <service-name>
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # é‡å¯æ•°æ®åº“
   docker-compose restart postgres
   ```

è¯¦ç»†æ•…éšœæ’é™¤è¯·å‚è€ƒ: [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md)

## ğŸ“š æ–‡æ¡£

- [è¯¦ç»†éƒ¨ç½²æ–‡æ¡£](docs/DEPLOYMENT.md) - å®Œæ•´çš„éƒ¨ç½²æŒ‡å—å’Œé…ç½®è¯´æ˜
- [æ•…éšœæ’é™¤æŒ‡å—](docs/TROUBLESHOOTING.md) - å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ”„ æ›´æ–°åº”ç”¨

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# 3. é‡å¯æœåŠ¡
docker-compose up -d
```

## ğŸ’¾ æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U zhiweijz zhiweijz > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T postgres psql -U zhiweijz zhiweijz < backup.sql
```

## ğŸŒŸ ç‰¹æ€§

- âœ… **ä¸€é”®éƒ¨ç½²** - å•ä¸ªå‘½ä»¤å®Œæˆæ‰€æœ‰æœåŠ¡éƒ¨ç½²
- âœ… **è‡ªåŠ¨è¿ç§»** - æ•°æ®åº“schemaè‡ªåŠ¨åˆå§‹åŒ–å’Œæ›´æ–°
- âœ… **å¥åº·æ£€æŸ¥** - æ‰€æœ‰æœåŠ¡éƒ½é…ç½®äº†å¥åº·æ£€æŸ¥
- âœ… **æ—¥å¿—ç®¡ç†** - ç»Ÿä¸€çš„æ—¥å¿—æ”¶é›†å’ŒæŸ¥çœ‹
- âœ… **æ€§èƒ½ä¼˜åŒ–** - Nginxç¼“å­˜ã€Gzipå‹ç¼©ã€è¿æ¥æ± 
- âœ… **å®‰å…¨é…ç½®** - è¯·æ±‚é™æµã€å®‰å…¨å¤´ã€ç½‘ç»œéš”ç¦»
- âœ… **æ•°æ®æŒä¹…åŒ–** - æ•°æ®åº“æ•°æ®æŒä¹…åŒ–å­˜å‚¨
- âœ… **æ˜“äºç»´æŠ¤** - å®Œæ•´çš„ç®¡ç†è„šæœ¬å’Œæ–‡æ¡£

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤æ–‡æ¡£](docs/TROUBLESHOOTING.md)
2. æ£€æŸ¥å®¹å™¨æ—¥å¿—: `docker-compose logs`
3. æäº¤Issueåˆ°é¡¹ç›®ä»“åº“

---

**ğŸ‰ äº«å—ä½¿ç”¨åªä¸ºè®°è´¦ï¼**
